!function(){"use strict";var t={91:function(t){t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},826:function(t,e,n){t.exports=n.p+"assets/logo.svg"},302:function(t,e,n){t.exports=n.p+"assets/rs_school.svg"}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,n),a.exports}n.m=t,n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t}(),n.b=document.baseURI||self.location.href,function(){var t=n(91),e=n.n(t),i=new URL(n(826),n.b),s=new URL(n(302),n.b);e()(i),e()(s),n.p,n.p,n.p,n.p;const a=[["#afafaf","#FFFFFF"],["#FAE793","#505050"],["#f8e4b7","#505050"],["#FECE3D","#505050"],["#f8a941","#FFFFFF"],["#B4AC4E","#e3e3e3"],["#D2E9A3","#505050"],["#BFCF6F","#505050"],["#7ABCB8","#FFFFFF"],["#9DC183","#505050"],["#388B69","#e3e3e3"],["#F8D6E2","#505050"],["#DFA3BE","#505050"],["#ffaeb6","#505050"],["#D4466C","#e3e3e3"],["#B84A4B","#e3e3e3"],["#B4CEEB","#505050"],["#72BAE1","#FFFFFF"],["#91A1EE","#505050"],["#0783C6","#e3e3e3"],["#5772CF","#FFFFFF"],["#D7D4F8","#505050"],["#BB95C1","#505050"],["#9C86C9","#FFFFFF"],["#7C69C5","#e3e3e3"],["#9D5694","#e3e3e3"]],o=["#9DC183","#505050"];var r;!function(t){t[t.monday=0]="monday",t[t.tuesday=1]="tuesday",t[t.wednesday=2]="wednesday",t[t.thursday=3]="thursday",t[t.friday=4]="friday",t[t.saturday=5]="saturday",t[t.sunday=6]="sunday"}(r||(r={}));var d=r;function l(t){return t instanceof EventTarget}function h(t,e=document){const n=e.querySelector(t);if(null===n)throw new Error("Ups! This element is not found!");return n}function c(t,e=document){return h(`.${t}`,e)}function u(t,e){const n=document.createElement(t);return n.classList.add(e),n}function m(...t){t.forEach((t=>{t.disabled=!1}))}function p(...t){t.forEach((t=>{t.disabled=!0}))}function g(t){return t.sort(((t,e)=>t.duration>e.duration?-1:1))}function f(t){if(t<60&&t>=0)return`${t} min`;if(t>=60)return t%60==0?`${Math.floor(t/60)} h`:`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")} h`;throw new Error("Wrong value in minToHour fn")}function v(t){if(t>=0)return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`;throw new Error("Wrong value in minToHour fn")}function y(t){return Math.floor(t/60)}function _(t){return(t%60).toString().padStart(2,"0")}function w(t,e){t instanceof Error&&"401"===t.message&&e("/login")}function T(t){for(let e=0;e<7;e+=1){const n=e.toString();if(d[e]===t.substring(1))return n}return""}function L(t,e){return Math.floor(e/t*1440)}function D(t,e){return t/1440*e}function k(t){const e=t.clientWidth,n=t.cloneNode(!0);let i=0;if(n instanceof HTMLElement){c("img-container").append(n),n.style.transform="scale(1)",n.style.boxShadow="none",i=e/2;const t=n.childNodes.item(1);t instanceof HTMLElement&&(t.style.display="none"),e>100&&(n.style.width="70px",n.style.height=n.style.width,n.firstChild instanceof HTMLElement&&(n.firstChild.style.fontSize="14px"),i=35),n.lastChild instanceof HTMLElement&&(n.lastChild.style.display="none")}if(!(n instanceof HTMLElement))throw new Error("Ups! This element is not found!");return{icon:n,center:i}}function P(t,e){return t.length<=e?t:`${t.slice(0,e-3)}...`}function E(t){const e=document.createElement("h2");return e.classList.add("banner"),e.innerText=t,e}function b(){const t=new Date;return 0===t.getDay()?6:t.getDay()-1}function M(t){const e=Number(t);return a[e]||o}var x=class{constructor(){this.opened=!1,this.popup=c("popup")}editorMode(t){const e=n=>this.close(n,e,t);this.popup.addEventListener("click",e)}editorModeOff(t){const e=n=>this.close(n,e,t);this.popup.removeEventListener("click",e)}close(t,e,n){const{target:i}=t;i instanceof HTMLElement&&(i.classList.contains("popup")&&(n&&n(),this.clean(i),this.popup.removeEventListener("click",e)),i.closest(".editor__button")&&this.popup.removeEventListener("click",e)),i instanceof SVGElement&&i.closest(".editor__button")&&this.popup.removeEventListener("click",e)}easyClose(){this.clean(this.popup)}clean(t){t.addEventListener("transitionend",(()=>{this.opened=!1,t.innerHTML=""}),{once:!0}),t.classList.remove("popup_show")}open(t){this.opened?this.refresh(t):(this.popup.append(t),setTimeout((()=>{this.opened=!0,this.popup.classList.add("popup_show")}),0))}refresh(t){this.popup.innerHTML="",this.popup.append(t)}isOpen(){return this.opened}},I=class{static async registration(t){return this.post(t,"/users","/registration")}static async login(t){return this.post(t,"/users","/login")}static async logout(){return this.post({},"/users","/logout")}static async getWeekDistribution(){return this.get(!1,"/weekDistribution","/get")}static async deletePlan(t){return this.delete(t,"/plans")}static async getAllPlans(){return this.get(!1,"/plans")}static async createNewPlan(t){return this.post(t,"/plans")}static async editPlan(t){return this.post(t,"/plans","/update")}static async pushPlanToDay(t){return this.post(t,"/weekDistribution","/adjustPlan")}static async getUserProfile(){return this.get(!1,"/users","/profile")}static async saveUserSettings(t){return this.post(t,"/users","/update")}static async getStatistics(){return this.get(!1,"/statistics","/get")}static async getConfirmDayInfo(){return this.get(!1,"/statistics","/isDayConfirmed")}static async getDayDistribution(t){return this.get(t,"/dayDistribution","/get")}static async confirmDay(t){return this.post(t,"/statistics","/confirmDay")}static async pushDayDistribution(t){return this.post(t,"/dayDistribution","/adjustPlan")}static async getThoughts(){return this.get(!1,"/thoughts")}static async createThoughts(t){return this.post(t,"/thoughts")}static async updateThought(t){return this.post(t,"/thoughts","/update")}static async deleteThought(t){return this.delete(t,"/thoughts")}static async convertToPlan(t,e){return this.post(t,"/thoughts","/convertToPlan",`/${e}`)}static async get(t,...e){let n=`https://radiant-shelf-12164.herokuapp.com/api${e.join("")}`;t&&(n=`${n}/${t}`);const i=await fetch(n,{method:"GET",credentials:"include"}),s=await i.json();if(!i.ok)throw new Error(i.status.toString());return s}static async post(t,...e){const n={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)},i=await fetch(`https://radiant-shelf-12164.herokuapp.com/api${e.join("")}`,n),s=await i.json();if(!i.ok)throw new Error(i.status.toString());return s}static async delete(t,...e){const n=await fetch(`https://radiant-shelf-12164.herokuapp.com/api${e.join("")}/${t}`,{method:"DELETE",credentials:"include"}),i=await n.json();if(!n.ok)throw new Error(n.status.toString());return i}},C=class{makeNavButton(t,e,n){const i=u("button","nav-button");return i.classList.add("nav-button"),i.innerText=t,i.addEventListener("click",(()=>n(e))),i}makeBanner(t,e){const n=document.createElement("div");n.classList.add("banner",`banner_${t}`);const i=document.createElement("h2");return i.classList.add("banner__title"),i.innerText=e,n.append(i),n}makeSaveButton(t){if(!document.querySelector(".save-button")){const e=u("button","save-button");e.innerText="Save",e.addEventListener("click",t),e.classList.add("save-button_visible"),e.addEventListener("animationend",(()=>e.classList.remove("save-button_visible")),{once:!0}),c("settings").append(e)}}disableSaveButton(){c("save-button").disabled=!0}removeSaveButton(){const t=c("save-button");t.classList.add("save-button_hidden"),t.addEventListener("animationend",(()=>t.remove()))}},S=class{constructor(t){this.goTo=t,this.layout=new C,this.today=this.layout.makeNavButton("today",this.makeTodayPath(),this.goTo)}makeTodayPath(){return`/${d[b()]}`}paintToday(t){t===b().toString()?this.today.classList.add("nav-button_active"):this.today.classList.remove("nav-button_active")}makeInfoBlock(t){return t.classList.add("header__info"),t}makeNav(t){const e=u("nav","nav");return[this.layout.makeNavButton("week","/plan",this.goTo),this.today,this.layout.makeNavButton("confirm","/confirm",this.goTo),this.layout.makeNavButton("profile","/profile",this.goTo)].forEach((n=>{n.innerText===t?.toString()&&n.classList.add("nav-button_active"),e.append(n)})),e}makeLogo(){const t=u("div","header__logo");return t.addEventListener("click",(()=>this.goTo("/"))),t}makeName(t){const e=u("h1","header__name");return e.innerText=t,e}draw(t,e,n){const i=u("header","header");return i.append(this.makeLogo(),this.makeName(t),this.makeNav(e)),n&&i.append(this.makeInfoBlock(n)),i}},F=["flex-start","flex-end","center"],H=class{constructor(t){this.planInfo=t,this.width=0,this.blur=u("div","plan-round__blur")}getUniqValue(){const[t]=M(this.planInfo.color);return parseInt(t.slice(5,6),16)+parseInt(t.slice(4,5),16)}getFontSize(){return this.width/5.5+"px"}getBlurHeight(t){return t/this.planInfo.duration*this.width+"px"}getValueSize(){return this.width/20+8+"px"}paintRound(t){this.blur.style.height=this.getBlurHeight(t)}setWidth(t){let e=(t-70)*(this.planInfo.duration/1425)+70;e<70&&(e=70),e>t&&(e=t),this.width=e}draw(){const t=document.createElement("div"),e=document.createElement("span"),n=document.createElement("span");t.setAttribute("draggable","true"),t.setAttribute("data-plan-id",this.planInfo._id),t.classList.add("plan-round","button"),n.classList.add("plan-round__value");const[i,s]=M(this.planInfo.color);t.style.backgroundColor=i,e.innerText=this.planInfo.title,e.style.fontSize=this.getFontSize(),n.innerText=f(this.planInfo.duration),n.style.fontSize=this.getValueSize(),t.style.width=`${this.width}px`,t.style.height=t.style.width;const a=this.getUniqValue();return t.style.margin=`${a}px`,t.style.alignSelf=`${F[a%F.length]}`,t.style.color=s,n.style.color=s+128..toString(16),t.append(e,this.blur,n),t}},B=class{constructor(t,e,n){this.name=t,this.goTo=e,this.editor=n,this.dayId=""}async getFilledPage(){const t=document.createElement("h1");return t.innerText=this.name,t}async animatedFilledPageAppend(t){t.classList.add("main__container_hide");const e=await this.getFilledPage();t.innerHTML="",t.classList.remove("main__container_hide"),t.append(e)}async draw(t){t&&(this.dayId=t);const e=c("main__container");await this.animatedFilledPageAppend(e)}},W=class extends C{constructor(t){super(),this.goTo=t}makeWeekLine(){const t=document.createElement("div");return t.classList.add("plan__week-line"),t}makeInfoText(t){const e=u("div","plan__text-container"),n=u("div","plan__text-value"),i=u("div","plan__text-value");return i.innerText=t,e.append(n,i),e}createDay(t){const e=document.createElement("div");e.classList.add("plan__day"),e.setAttribute("data-day-id",t.toString());const n=document.createElement("div");n.classList.add("plan__day-line");const i=document.createElement("div");i.classList.add("plan__day-name"),i.innerHTML=d[t].slice(0,3);const s=document.createElement("div");return s.classList.add("plan__day-hours"),e.append(n,i,s),e.addEventListener("click",(()=>this.goTo(`/${d[t]}`))),e}fillPlanDaysContainer(t){const e=t;for(let t=0;t<7;t+=1)e.append(this.createDay(t));return e}makeAddButton(){const t=document.createElement("button");t.classList.add("button","plan__button-add");const e=document.createElement("span");e.innerText="+",e.classList.add("plan__button-add-name");const n=document.createElement("span");return n.classList.add("plan__button-add-value"),t.append(e,n),t}makeReturnToWeekZone(t,e,n){const i=u("div","day-page__return"),s=document.createElement("div");return s.style.backgroundImage="url('./assets/svg/return.svg')",i.append(s),this.addReturnListeners(i,t,e,n),i}addReturnListeners(t,e,n,i){t.addEventListener("dragover",(function(t){t.preventDefault();try{c("plan-round_drag"),this.classList.add("day-page__return_over")}catch{}})),t.addEventListener("dragleave",(function(){this.classList.remove("day-page__return_over")})),t.addEventListener("drop",(async t=>{t.stopPropagation(),t.preventDefault();const{currentTarget:s}=t;s instanceof HTMLElement&&s.classList.remove("day-page__return_over");try{c("plan-round_drag")}catch{return}const a=c("plan-round_drag"),o=a.dataset.planId;if(!o)throw new Error("no id");const r=i.filter((t=>t._id!==o)).map((t=>{const{_id:e,from:n,to:i}=t;return{planId:e,from:n,to:i}})),l={dayOfWeek:Number(e),dayDistribution:r},h=n.filter((t=>t._id===o))[0].duration,u={dayOfWeek:Number(e),planId:o,duration:-h};if(o)try{a.style.visibility="hidden",c("main__container").classList.add("main__container_hide"),await Promise.all([I.pushPlanToDay(u),I.pushDayDistribution(l)]),this.goTo(`/${d[Number(e)]}`)}catch(t){w(t,this.goTo)}}))}makeRemoveZone(){const t=u("div","plan__remove"),e=document.createElement("div");return e.style.backgroundImage="url('./assets/svg/bin.svg')",t.append(e),t.addEventListener("dragover",(function(t){t.preventDefault(),this.classList.add("plan__remove_over")})),t.addEventListener("dragleave",(function(){this.classList.remove("plan__remove_over")})),t.addEventListener("drop",(async t=>{t.stopPropagation(),t.preventDefault();const{currentTarget:e}=t;e instanceof HTMLElement&&e.classList.remove("plan__remove_over");const n=c("plan-round_drag"),i=n.dataset.planId;if(i)try{n.style.display="none",c("main__container").classList.add("main__container_hide"),await I.deletePlan(i),this.goTo("/plan")}catch(t){w(t,this.goTo)}})),t}makePlanBody(){const t=u("div","plan__body"),e=u("div","plan__field"),n=u("div","plan__buttons"),i=u("div","week-fields"),s=u("div","week-fields__big"),a=u("div","week-fields__small"),o=document.createElement("div"),r=u("div","plan__left-column"),d=u("div","plan__name");d.innerText="Week",d.classList.add("title");const l=this.fillPlanDaysContainer(o);return l.classList.add("plan__days"),r.append(d,l),n.append(this.makeAddButton(),this.makeRemoveZone()),i.append(s,a),e.append(n,i),t.append(r,e),t}createPlanListItem(t){const[e]=M(t.color),n=u("li","plan-list__item"),i=u("div","plan-list__color");i.style.backgroundColor=e;const s=200*t.duration/1440*2;i.style.width=`${s}px`;const a=u("span","plan-list__name");a.innerText=t.title;const o=u("span","plan-list__dur");return o.innerText=`( ${f(t.duration)} )`,n.append(i,a,o),n}fillPlanList(t,e){const n=t;return e.forEach((t=>{n.append(this.createPlanListItem(t))})),n}makeDayBody(t,e,n){const i=u("div","day-page__body"),s=u("div","day-page__info"),a=u("div","day-page__field"),o=u("div","day-page__tools"),r=u("div","day-page__plans-zone"),l=u("h1","day-page__name");l.classList.add("title"),l.innerText=d[Number(t)];const h=u("ul","plan-list");return this.fillPlanList(h,e),o.append(this.makeReturnToWeekZone(t,e,n),this.makeAddButton()),a.append(o,r),s.append(l,h),i.append(s,a),i}},A={_id:"",color:"1",title:"Plan for ...",text:"- Make some awesome things",duration:15},$=class{constructor(t,e,n,i,s,a,o){this.fromMin=0,this.newToMin=0,this.newFromMin=0,this.toMin=0,this.zone={from:0,to:1440},this.move={start:0},this.goTo=a,this.pushToServer=s,this.paintRound=o,this.timelineWidthPx=t,this.getDistPlans=n,this.updateDistPlans=i,this.plan=e,this.from=u("div","timeline-div__from"),this.to=u("div","timeline-div__to"),this.name=u("div","timeline-div__name"),this.name.innerText=this.plan.title,this.div=this.makeDiv(),this.pxToMin=L.bind(this,this.timelineWidthPx),this.minToPx=D.bind(this,this.timelineWidthPx)}rightButtonResize(t){const e=this.toMin-this.fromMin,n=Math.min(this.zone.to,this.fromMin+e+this.plan.duration),i=this.pxToMin(t.clientX-this.move.start);this.toMin+i>n?(this.newToMin=n,this.showDiv(this.fromMin,this.newToMin-this.fromMin)):e+i<15?(this.newToMin=this.fromMin+15,this.showDiv(this.fromMin,15)):(this.newToMin=this.toMin+i,this.showDiv(this.fromMin,e+i))}leftButtonResize(t){const e=this.toMin-this.fromMin,n=Math.max(this.zone.from,this.fromMin-this.plan.duration),i=this.pxToMin(this.move.start-t.clientX);this.fromMin-i<n?(this.newFromMin=n,this.showDiv(this.newFromMin,this.toMin-this.newFromMin)):e+i<15?(this.newFromMin=this.toMin-15,this.showDiv(this.newFromMin,15)):(this.newFromMin=this.fromMin-i,this.showDiv(this.newFromMin,e+i))}addSizeListener(t,e,n){const i=c("timeline__sensor"),s=c("main__container");t.addEventListener("mousedown",(t=>{t.stopPropagation(),this.move.start=t.clientX,this.newFromMin=this.fromMin,this.newToMin=this.toMin,this.div.setAttribute("draggable","false"),this.div.classList.add("timeline-div_active"),i.classList.add("timeline__sensor_active"),s.classList.add("main__container_no-select"),this.div.classList.add("timeline-div_fake"),n(),document.addEventListener("mousemove",e),document.addEventListener("mouseup",(async t=>{t.stopPropagation(),this.div.setAttribute("draggable","true"),this.div.classList.remove("timeline-div_active"),i.classList.remove("timeline__sensor_active"),s.classList.remove("main__container_no-select"),this.div.classList.remove("timeline-div_fake"),document.removeEventListener("mousemove",e),this.updatePlan(),this.paintRound(this.findRound(this.plan._id),this.plan);try{await this.pushToServer()}catch(t){w(t,this.goTo)}}),{once:!0})}))}findRound(t){const e=document.querySelector(`div[data-plan-id="${t}"]`);if(e instanceof HTMLElement)return e}updatePlan(){this.plan.duration-=this.fromMin-this.newFromMin,this.plan.duration-=this.newToMin-this.toMin;const t=this.getDistPlans();t.forEach((t=>{t.from===this.fromMin&&(t.from=this.newFromMin,t.to=this.newToMin)})),this.updateDistPlans(t),this.fromMin=this.newFromMin,this.toMin=this.newToMin,this.div.setAttribute("data-from",this.fromMin.toString())}makeDiv(){const[t,e]=M(this.plan.color),n=u("div","timeline-div");n.setAttribute("draggable","true"),n.setAttribute("data-plan-timeline-id",this.plan._id);const i=u("div","timeline-div__left");i.innerText="<";const s=u("div","timeline-div__right");s.innerText=">",this.addSizeListener(i,this.leftButtonResize.bind(this),this.setZoneStart.bind(this)),this.addSizeListener(s,this.rightButtonResize.bind(this),this.setZoneEnd.bind(this)),n.style.color=e;const a=u("div","timeline-div__body");return a.style.backgroundColor=t,a.append(i,this.name,s),n.append(this.from,a,this.to),this.addMoveListener(n),n}showDiv(t,e){this.setLeftFromMin(t),this.setWidthFromDur(e),this.updateFromView(t),this.updateToView(t+e),this.updateInfoView(e)}setLeftFromMin(t){this.div.style.left=`${this.minToPx(t)}px`}setWidthFromDur(t){this.div.style.width=`${this.minToPx(t)}px`}showTimeInterval(t,e){this.fromMin=t,this.toMin=t+e}updateFromView(t){this.from.innerText=v(t)}updateToView(t){this.to.innerText=v(t)}updateInfoView(t){this.minToPx(t)>55?this.div.classList.remove("timeline-div_hide"):this.div.classList.add("timeline-div_hide")}addMoveListener(t){t.addEventListener("mousedown",(t=>{t.stopPropagation()}))}draw(){return this.div}setZoneStart(){const t=this.getDistPlans().reduce(((t,e)=>e.to<=this.fromMin&&e.to>t?e.to:t),0);this.zone.from=t}setZoneEnd(){const t=this.getDistPlans().reduce(((t,e)=>e.from>=this.toMin&&e.from<t?e.from:t),1440);this.zone.to=t}},O=class extends B{constructor(t,e,n){super("Day",t,n),this.distPlans=[],this.notDistPlans=[],this.allDayPlans=[],this.allWeekPlans=[],this.weekDistribution=[],this.allPlansDist={},this.planRounds=[],this.popup=e,this.layout=new W(t),this.timeLine=new class{constructor(t){this.width=0,this.dayId="",this.plan=A,this.notDistPlans=[],this.distPlans=[],this.allDayPlans=[],this.dragInfo={canPush:!0,currentDiv:{fromMin:0,toMin:0},currentZone:{freeZone:!0,startMin:0,endMin:1440}},this.goTo=t,this.sensor=this.makeSensor(),this.showLine=u("div","timeline__show")}makeSensor(){const t=u("div","timeline__sensor");return this.addListenerEnter(t),this.addListenerOver(t),this.addListenerLeave(t),this.addListenerDrop(t),t}getPlanFromDiv(t){const e=t.dataset.planId;if(!e)throw new Error("no id");[this.plan]=this.notDistPlans.filter((t=>t._id===e))}getCursorX(t){const e=window.innerWidth,n=t.pageX-(e-this.width)/2;return n<0?0:n>this.width-D(this.width,15)?this.width-D(this.width,15):n}setStart(t,e){const{from:n,to:i}=e,{startMin:s}=this.dragInfo.currentZone;n<=t&&n>s&&(this.dragInfo.currentZone.startMin=n),i<=t&&i>s&&(this.dragInfo.currentZone.startMin=i)}setEnd(t,e){const{from:n,to:i}=e,{endMin:s}=this.dragInfo.currentZone;i>t&&i<s&&(this.dragInfo.currentZone.endMin=i),n>t&&n<s&&(this.dragInfo.currentZone.endMin=n)}setZoneType(t,e){const{from:n,to:i}=e;(n<=t&&i>t||this.dragInfo.currentZone.endMin-this.dragInfo.currentZone.startMin<15)&&(this.dragInfo.currentZone.freeZone=!1)}setCurrentZone(t){const e=L(this.width,t);this.dragInfo.currentZone.startMin=0,this.dragInfo.currentZone.endMin=1440,this.dragInfo.currentZone.freeZone=!0,this.distPlans.forEach((t=>{this.setStart(e,t),this.setEnd(e,t),this.setZoneType(e,t)}))}checkZone(t,e){if(e>=this.dragInfo.currentZone.endMin||e<this.dragInfo.currentZone.startMin){const e=this.getCursorX(t);this.setCurrentZone(e),this.dragInfo.currentZone.freeZone?this.appendDiv(this.plan):this.removeDiv()}}setCurrentDivTimeInterval(t,e){this.dragInfo.currentDiv.fromMin=t,this.dragInfo.currentDiv.toMin=t+e}getDistPlans(){return this.distPlans}appendDiv(t){if(t.duration>=15){const e=new $(this.width,t,this.getDistPlans.bind(this),this.updateDistPlans.bind(this),this.pushToServer.bind(this),this.goTo,this.paintRound.bind(this)),n=e.draw();n.addEventListener("dragstart",(t=>{this.startMove(t,e.fromMin,e.toMin)})),n.addEventListener("dragend",(async t=>{await this.stopMove(t)})),n.classList.add("timeline-div_fake"),this.currentDiv=e,this.currentDivHTML=n;const i=this.showLine.querySelector(".timeline-div_fake");i&&i.remove(),this.showLine.append(this.currentDivHTML)}}removeDiv(){this.currentDivHTML instanceof HTMLDivElement&&(this.currentDivHTML.remove(),this.currentDivHTML=void 0)}setDivWidth(t){return this.plan?Math.min(this.plan.duration,this.dragInfo.currentZone.endMin-t):0}addListenerEnter(t){t.addEventListener("dragenter",(t=>{t.preventDefault(),t.stopPropagation();const e=this.getCursorX(t);this.setCurrentZone(e),this.dragInfo.currentZone.freeZone?this.plan&&this.appendDiv(this.plan):this.removeDiv()}))}addListenerOver(t){t.addEventListener("dragover",(t=>{t.preventDefault(),t.stopPropagation();const e=this.getCursorX(t),n=L(this.width,e);this.checkZone(t,n);const i=this.setDivWidth(n);this.setCurrentDivTimeInterval(n,i),this.currentDiv&&(this.currentDiv.showDiv(n,i),this.currentDiv.showTimeInterval(n,i))}))}addListenerLeave(t){t.addEventListener("dragleave",(t=>{t.preventDefault(),t.stopPropagation(),this.currentDivHTML instanceof HTMLDivElement&&this.currentDivHTML.remove()}))}addListenerDrop(t){t.addEventListener("drop",(async t=>{t.preventDefault(),t.stopPropagation(),this.dropSmallPlan(),await this.drop()}))}async pushToServer(){const t=this.distPlans.map((t=>{const{_id:e,from:n,to:i}=t;return{planId:e,from:n,to:i}})),e={dayOfWeek:Number(this.dayId),dayDistribution:t};this.dragInfo.canPush?(this.dragInfo.canPush=!1,await I.pushDayDistribution(e),this.dragInfo.canPush=!0):setTimeout((async()=>{this.dragInfo.canPush=!1,await I.pushDayDistribution(e),this.dragInfo.canPush=!0}),2e3)}async drop(){if(this.currentDivHTML instanceof HTMLDivElement){const{_id:t,color:e,title:n,text:i}=this.plan,s={_id:t,color:e,title:n,text:i,from:this.dragInfo.currentDiv.fromMin,to:this.dragInfo.currentDiv.toMin};this.distPlans.push(s),this.reduceNoDistPlan(),this.paintRound(this.round,this.plan),this.currentDivHTML.setAttribute("data-from",s.from.toString()),this.currentDivHTML.classList.remove("timeline-div_fake"),this.currentDiv=void 0,this.currentDivHTML=void 0;try{await this.pushToServer()}catch(t){w(t,this.goTo)}}}dropSmallPlan(){if(this.currentDivHTML instanceof HTMLDivElement){const{fromMin:t}=this.dragInfo.currentDiv,{toMin:e}=this.dragInfo.currentDiv;e-t<15&&(this.dragInfo.currentDiv.fromMin=e-15,this.currentDiv&&this.currentDiv.showDiv(this.dragInfo.currentDiv.fromMin,15))}}paintRound(t,e){if(t){const n=this.allDayPlans.filter((t=>t._id===e._id))[0].duration,i=this.notDistPlans.filter((t=>t._id===e._id))[0],s=t.childNodes[1];s instanceof HTMLElement&&(s.style.height=100*(1-(i?i.duration:e.duration)/n)+"%")}}reduceNoDistPlan(){this.plan.duration-=this.dragInfo.currentDiv.toMin-this.dragInfo.currentDiv.fromMin}increaseNoDistPlan(){this.plan.duration+=this.dragInfo.currentDiv.toMin-this.dragInfo.currentDiv.fromMin}updateDistPlans(t){this.distPlans=t}fillTimeline(){this.showLine.innerHTML="",this.distPlans.forEach((t=>{const{_id:e,color:n,title:i,text:s,from:a,to:o}=t,r=this.notDistPlans.filter((t=>t._id===e))[0],d={_id:e,color:n,title:i,text:s,duration:0};r||this.notDistPlans.push(d);const l=new $(this.width,r||d,this.getDistPlans.bind(this),this.updateDistPlans.bind(this),this.pushToServer.bind(this),this.goTo,this.paintRound.bind(this)),h=l.draw();h.addEventListener("dragstart",(t=>{this.startMove(t,l.fromMin,l.toMin)})),h.addEventListener("dragend",(async t=>{await this.stopMove(t)})),this.showLine.append(h);const c=o-a;l.showDiv(a,c),l.showTimeInterval(a,c),h.setAttribute("data-from",a.toString())}))}startMove(t,e,n){const{target:i}=t;i instanceof HTMLDivElement&&(this.setRoundForDrag(t,i),this.setDragInfoCurrentDiv(e,n),this.increaseNoDistPlan(),this.deleteFromDistPlan(i.dataset.from),setTimeout((()=>{this.sensor.classList.add("timeline__sensor_active"),i.style.display="none"}),0))}async stopMove(t){const{target:e}=t;this.sensor.classList.remove("timeline__sensor_active"),c("plan-round_drag").classList.remove("plan-round_drag"),e instanceof HTMLElement&&e.remove(),this.paintRound(this.round,this.plan),t.dataTransfer&&"none"===t.dataTransfer.dropEffect&&await this.pushToServer()}setRoundForDrag(t,e){const n=e.dataset.planTimelineId,i=document.querySelector(`div[data-plan-id="${n}"]`);if(!(i instanceof HTMLDivElement))return;this.getPlanFromDiv(i),this.round=i;const{icon:s,center:a}=k(i);t.dataTransfer&&t.dataTransfer.setDragImage(s,a,a),i.classList.add("plan-round_drag")}setDragInfoCurrentDiv(t,e){this.dragInfo.currentDiv.fromMin=t,this.dragInfo.currentDiv.toMin=e}deleteFromDistPlan(t){t&&(this.distPlans=this.distPlans.filter((e=>e.from.toString()!==t)))}setTimeline(t,e,n,i){this.width=this.sensor.clientWidth,this.notDistPlans=t,this.distPlans=e,this.allDayPlans=n,this.dayId=i,this.fillTimeline()}draw(){const t=u("div","timeline");return t.append(this.showLine,this.sensor),t}}(t),this.header=new S(t)}setRoundClick(t,e){const n=this.allWeekPlans.filter((t=>t._id===e.planInfo._id))[0].duration,i=e.planInfo.duration+Math.min(n-this.allPlansDist[e.planInfo._id],1440-this.getDayDistTime());t.addEventListener("click",(()=>{const t=this.getDayPlanDistTime(e);this.editor.open(t,i,1,e.planInfo,this.dayId)}))}makePlans(){this.planRounds=[],this.planRounds=this.allDayPlans.map((t=>new H(t)))}showElements(){setTimeout((()=>{c("plan__button-add").classList.add("scale-normal"),c("day-page__return").classList.add("scale-normal"),document.querySelectorAll(".plan-list__color").forEach((t=>{t instanceof HTMLDivElement&&t.classList.add("scale-normal")})),document.querySelectorAll(".plan-round").forEach((t=>{t instanceof HTMLDivElement&&t.classList.add("scale-normal")}))}),0)}getDayDistTime(){return this.allDayPlans.reduce(((t,e)=>t+e.duration),0)}setAddButton(){c("plan__button-add").addEventListener("click",(()=>{this.popup.editorMode();const t=1440-this.getDayDistTime();if(t<15)return void this.popup.open(E("Less than 15 minutes left\n\n Free up your DAY time"));const e=10080-this.getFilledWeekTime();e<15?this.popup.open(E("Less than 15 minutes left\n\n Free up your WEEK time")):this.editor.open(15,Math.min(e,t),3,void 0,this.dayId)}))}getFilledWeekTime(){return this.allWeekPlans.reduce(((t,e)=>t+e.duration),0)}fillTextInfo(){const t=this.getDayDistTime();c("plan__text-value").innerText=f(t),c("plan__button-add-value").innerText=f(1440-t)}fillPlansZone(){const t=c("day-page__plans-zone"),e=.4*t.clientWidth;this.planRounds.forEach((n=>{n.setWidth(e);const i=n.draw(),s=this.getDayPlanDistTime(n);n.paintRound(s),this.setRoundClick(i,n),this.setRoundMove(i),t.append(i)}))}setRoundMove(t){const e=c("day-page__return"),n=c("timeline"),i=c("timeline__sensor");t.addEventListener("dragstart",(t=>{t.target instanceof HTMLDivElement&&(this.timeLine.getPlanFromDiv(t.target),this.timeLine.round=t.target)})),t.addEventListener("dragstart",(function(t){i.classList.add("timeline__sensor_active");const{icon:s,center:a}=k(this);t.dataTransfer&&t.dataTransfer.setDragImage(s,a,a),this.classList.add("plan-round_drag"),e.classList.add("plan__remove_drag"),n.classList.add("timeline_drag")})),t.addEventListener("dragend",(function(){i.classList.remove("timeline__sensor_active"),this.classList.remove("plan-round_drag"),e.classList.remove("plan__remove_drag"),n.classList.remove("timeline_drag")}))}setPlanDistTime(){const t=this.weekDistribution.flat();this.allPlansDist=t.reduce(((t,e)=>(t[e._id]?t[e._id]+=e.duration:t[e._id]=e.duration,t)),{})}getDayPlanDistTime(t){const e=this.notDistPlans.filter((e=>e._id===t.planInfo._id))[0];return e?t.planInfo.duration-e.duration:t.planInfo.duration}async setDayInfo(){const t=await Promise.all([I.getDayDistribution(this.dayId),I.getWeekDistribution(),I.getAllPlans()]),[e,n,i]=t,{distributedPlans:s,notDistributedPlans:a}=e;this.allDayPlans=g(n[Number(this.dayId)]),this.weekDistribution=n,this.allWeekPlans=i,this.distPlans=s,this.notDistPlans=a}async getFilledPage(){await this.setDayInfo(),this.setPlanDistTime(),this.makePlans();const t=u("div","day-page__container");return this.header.paintToday(this.dayId),t.append(this.header.draw(d[Number(this.dayId)],void 0,this.layout.makeInfoText(" / 24 h")),u("div","timeline-header"),this.timeLine.draw(),this.layout.makeDayBody(this.dayId,this.allDayPlans,this.distPlans)),t}async draw(t){this.dayId=t;try{const e=c("main__container");await this.animatedFilledPageAppend(e),this.fillTextInfo(),this.fillPlansZone(),this.setAddButton(),this.showElements(),this.timeLine.setTimeline(this.notDistPlans,this.distPlans,this.allDayPlans,t)}catch(t){this.goTo("/login")}}};const V=[{id:0,_id:"",hours:24,from:0,to:1440,color:"0",title:"Free time",text:""}],N={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,planPosWidth:document.documentElement.clientWidth/2-690+250,planPosHeight:document.documentElement.clientHeight/2-15,clockPosWidth:document.documentElement.clientWidth/2+690-330,clockPosHeight:document.documentElement.clientHeight/2-15};var R=class{constructor(){this.hours=0,this.date=new Date,this.dayOfWeek=0}setMorningSVG(t){return`<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n    <svg\n      xmlns="http://www.w3.org/2000/svg"\n      viewBox="0 0 24 24"\n      style="stroke: ${t};"\n      class="day-info__svg"\n      fill="none"\n      stroke-width="2"\n      stroke-linecap="round"\n      stroke-linejoin="round"\n    >\n      <path d="M12 2v8" />\n      <path d="M5.2 11.2l1.4 1.4" />\n      <path d="M2 18h2" />\n      <path d="M20 18h2" />\n      <path d="M17.4 12.6l1.4-1.4" />\n      <path d="M22 22H2" />\n      <path d="M8 6l4-4 4 4" />\n      <path d="M16 18a4 4 0 00-8 0" />\n    </svg>`}setDaySVG(t){return`<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n    <svg\n      xmlns="http://www.w3.org/2000/svg"\n      viewBox="0 0 24 24"\n      style="stroke: ${t};"\n      class="day-info__svg"\n      fill="none"\n      stroke-width="2"\n      stroke-linecap="round"\n      stroke-linejoin="round"\n    >\n      <circle cx="12" cy="12" r="4" />\n      <path d="M12 2v2" />\n      <path d="M12 20v2" />\n      <path d="M5 5l1.5 1.5" />\n      <path d="M17.5 17.5L19 19" />\n      <path d="M2 12h2" />\n      <path d="M20 12h2" />\n      <path d="M5 19l1.5-1.5" />\n      <path d="M17.5 6.5L19 5" />\n    </svg>`}setEveningSVG(t){return`<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n    <svg\n      xmlns="http://www.w3.org/2000/svg"\n      viewBox="0 0 24 24"\n      style="stroke: ${t};"\n      class="day-info__svg"\n      fill="none"\n      stroke-width="2"\n      stroke-linecap="round"\n      stroke-linejoin="round"\n    >\n      <path d="M12 10V2" />\n      <path d="M5.2 11.2l1.4 1.4" />\n      <path d="M2 18h2" />\n      <path d="M20 18h2" />\n      <path d="M17.4 12.6l1.4-1.4" />\n      <path d="M22 22H2" />\n      <path d="M16 6l-4 4-4-4" />\n      <path d="M16 18a4 4 0 00-8 0" />\n    </svg>`}setNightSVG(t){return`<?xml version="1.0" encoding="utf-8"?>\n    <svg\n      xmlns="http://www.w3.org/2000/svg"\n      viewBox="0 0 24 24"\n      style="stroke: ${t};"\n      class="day-info__svg"\n      fill="none"\n      stroke-width="2"\n      stroke-linecap="round"\n      stroke-linejoin="round"\n    >\n      <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />\n    </svg>`}showDayInfo(t){return`${this.setIcon(t)}\n${this.setDay(this.date)}`}setIcon(t){return this.hours>=6&&this.hours<12?this.setMorningSVG(t):this.hours>=12&&this.hours<18?this.setDaySVG(t):this.hours>=18&&this.hours<24?this.setEveningSVG(t):this.setNightSVG(t)}setDay(t){const e=new Intl.DateTimeFormat("en",{weekday:"short",month:"long",day:"numeric"}).format(t).replace(",","").split(" ");return`\n    <div class="day-info__date">${e[2]}</div>\n    <div class="day-info__wrapper">\n      <div class="day-info__day">${e[0]}</div>\n      <div class="day-info__month">${e[1]}</div>\n    </div>`}showTime(t,e,n,i,s){if("/"!==window.location.pathname||!document.querySelector(".clock"))return;const a=new Date,o=a.getHours()*e,r=a.getMinutes()*t;i.style.transform=`rotateZ(${o+r/n}deg)`,s.style.transform=`rotateZ(${r}deg)`}getTime(){const t=h(".hour__circle"),e=h(".minutes__circle");this.showTime(6,30,12,t,e),setInterval((()=>{this.showTime(6,30,12,t,e)}),1e3)}},U=class extends R{constructor(t){super(),this.goTo=t,this.toDoInst=new class{async updateToDoText(t,e,n){const i=t.find((t=>t._id===e._id));i&&(i.text=n,e.text=n,await I.editPlan(i))}draw(t,e){const n=u("div","to-do__wrapper"),i=u("h2","to-do__title");if(t)if(i.textContent=t.title,n.append(i),t.text){const i=u("textarea","to-do__textarea");i.textContent=t.text,i.spellcheck=!1,n.append(i),i.addEventListener("blur",(()=>this.updateToDoText(e,t,i.value)))}else{const t=u("div","to-do__text");t.textContent="There are no plans at this time.",n.append(t)}return n}},this.chartInst=new class{createSvgElement(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.entries(e).forEach((([t,e])=>n.setAttributeNS(null,t,e))),n}createChart(t,e,n){const{strokeWidth:i,radius:s}=n,a=s-i/2,o=2*s,r=2*Math.PI*a,d=[];e.forEach(((t,e)=>{const n=r*t.hours/12;let i=.25*r;if(e>0){const t=d[e-1];i=t.offset-t.width}d.push({...t,width:n,offset:i})}));const l=this.createSvgElement("svg",{viewBox:`0 0 ${o} ${o}`,fill:"none",width:o,height:o});d.forEach((t=>{const e=this.createSvgElement("circle",{id:t.id,cx:a+i/2,cy:a+i/2,r:a,"stroke-dasharray":`${t.width} ${r-t.width}`,"stroke-dashoffset":t.offset.toString(),stroke:M(t.color)[0],class:M(t.color)[1],"stroke-width":i});l.append(e)})),t.append(l)}},this.distributedPlans=[],this.dayData=[V,V],this.chartData=V,this.halfOfDay="AM",this.minutes=0,this.seconds=1,[this.currPlan]=V,this.currPlanNum=0,[this.currColor,this.currFontColor]=M(this.chartData[0].color),this.dayOfWeek=0}setDistributedPlans(t,e){this.dayOfWeek=e,this.distributedPlans=t}transformData(){const t=[];let e=0;0===this.distributedPlans.length?t.push(V[0]):this.distributedPlans.forEach(((n,i,s)=>{if(0===i&&0!==this.distributedPlans[i].from){const n={id:e,_id:"",hours:(this.distributedPlans[i].from-0)/60,from:0,to:this.distributedPlans[i].from,color:"0",title:"Free time",text:""};t.push(n),e+=1}if(i!==this.distributedPlans.length-1){const n=this.returnDataObj(e,i);if(t.push(n),e+=1,this.distributedPlans[i].to!==this.distributedPlans[i+1].from){const n={id:e,_id:"",hours:(this.distributedPlans[i+1].from-this.distributedPlans[i].to)/60,from:this.distributedPlans[i].to,to:this.distributedPlans[i+1].from,color:"0",title:"Free time",text:""};t.push(n),e+=1}}else{const n=this.returnDataObj(e,i);if(t.push(n),e+=1,1440!==this.distributedPlans[s.length-1].to){const n={id:e,_id:"",hours:(1440-this.distributedPlans[i].to)/60,from:this.distributedPlans[i].to,to:1440,color:"0",title:"Free time",text:""};t.push(n),e+=1}}})),this.splitData(t)}returnDataObj(t,e){return{id:t,_id:this.distributedPlans[e]._id,hours:(this.distributedPlans[e].to-this.distributedPlans[e].from)/60,from:this.distributedPlans[e].from,to:this.distributedPlans[e].to,color:this.distributedPlans[e].color,title:this.distributedPlans[e].title,text:this.distributedPlans[e].text}}splitData(t){const e=[],n=[];t.forEach((t=>{const i=12-e.reduce(((t,e)=>t+e.hours),0);if(t.hours<=i)e.push(t);else if(0!==i){const s={...t},a={...t};s.hours=i,e.push(s),a.hours=t.hours-s.hours,n.push(a)}else n.push(t)})),this.dayData=[e,n]}setHalfOfDayData(){this.chartData=this.hours<12?this.dayData[0]:this.dayData[1],this.halfOfDay=this.hours<12?"AM":"PM"}setCurrTime(){const t=new Date,e=t.getDay()-1<0?6:t.getDay()-1,n=t.getHours(),i=60*n+t.getMinutes();this.seconds=60*i+t.getSeconds(),this.date=t,this.dayOfWeek=e,this.hours=n,this.minutes=i}updateDataByTime(){setInterval((()=>{"/"===window.location.pathname&&document.querySelector(".clock")&&(this.setCurrTime(),this.setHalfOfDayData(),this.setChartSector(),this.updateDayInfo())}),1e3)}setChartSector(){this.minutes===this.currPlan.to&&(this.setDataByTime(),this.updateToDo())}setDataByTime(){const t=this.chartData.filter((t=>this.minutes>=t.from&&this.minutes<t.to));[this.currPlan]=t,this.currPlanNum=t[0].id,this.setColor(t[0].color)}setColor(t){[this.currColor,this.currFontColor]=M(t)}showToDo(t){if(!(t.target instanceof SVGCircleElement&&t.target.id))return;const e=+t.target.id,n=h(".to-do"),i=t.target.getAttribute("stroke"),s=t.target.getAttribute("class");if(i&&s){n.style.backgroundColor=i,n.parentElement&&(n.parentElement.style.color=s);const t=document.querySelector(".day-info__svg");t instanceof SVGElement&&(t.style.stroke=s)}n.innerHTML="";let a=("AM"===h(".time-of-day").textContent?this.dayData[0]:this.dayData[1]).find((t=>t.id===e));a||(a=this.currPlan);const o=this.toDoInst.draw(a,this.distributedPlans);n.append(o)}showCurrToDo(t){if(!(t.target instanceof SVGCircleElement&&t.target.id))return;const e=h(".to-do");e.style.backgroundColor=this.currColor,e.parentElement&&(e.parentElement.style.color=this.currFontColor);const n=document.querySelector(".day-info__svg");n instanceof SVGElement&&(n.style.stroke=this.currFontColor),e.innerHTML="";const i=this.toDoInst.draw(this.currPlan,this.distributedPlans);e.append(i)}changeTimeOfDay(t){t.target instanceof HTMLElement&&("AM"===t.target.textContent?(t.target.textContent="PM",[,this.chartData]=this.dayData):(t.target.textContent="AM",[this.chartData]=this.dayData),this.updateChart())}showCurrHalfOfDay(){h(".time-of-day").textContent=this.halfOfDay,this.setHalfOfDayData(),this.updateChart()}updateToDo(){const t=h(".to-do");t.style.backgroundColor=this.currColor,t.parentElement&&(t.parentElement.style.color=this.currFontColor);const e=document.querySelector(".day-info__svg");e instanceof SVGElement&&(e.style.stroke=this.currFontColor),t.innerHTML="";const n=this.toDoInst.draw(this.currPlan,this.distributedPlans);t.append(n)}updateChart(){const t=h(".chart");t.innerHTML="",this.chartInst.createChart(t,this.chartData,{strokeWidth:14,radius:285}),h(".clock").append(t)}updateDayInfo(){21600!==this.seconds&&43200!==this.seconds&&64800!==this.seconds&&0!==this.seconds||(h(".day-info").innerHTML=this.showDayInfo(this.currFontColor)),43200===this.seconds&&(h(".time-of-day").textContent=this.halfOfDay,this.setHalfOfDayData(),this.updateChart())}showNewDay(t,e){this.setDistributedPlans(t,e),this.setValidChartData(),this.updateToDo(),this.updateChart(),h(".time-of-day").innerHTML=this.halfOfDay}setValidChartData(){this.transformData(),this.setCurrTime(),this.setHalfOfDayData(),this.setDataByTime()}draw(t,e){this.setDistributedPlans(t,e),this.setValidChartData(),this.updateDataByTime();const n=u("div","clock"),i=u("div","hour"),s=u("div","hour__circle"),a=u("div","minutes"),o=u("div","minutes__circle");i.append(s),a.append(o);const r=u("div","chart");this.chartInst.createChart(r,this.chartData,{strokeWidth:14,radius:285});const l=u("div","day-info");l.innerHTML=this.showDayInfo(this.currFontColor);const h=u("div","to-do");h.style.backgroundColor=this.currColor,n.style.color=this.currFontColor;const c=this.toDoInst.draw(this.currPlan,this.distributedPlans),m=u("div","time-of-day");return m.innerText=this.halfOfDay,h.append(c),n.append(i,a,r,h,l,m),l.addEventListener("click",(()=>this.goTo(`/${d[this.dayOfWeek]}`))),m.addEventListener("click",(t=>this.changeTimeOfDay(t))),r.addEventListener("mouseover",(t=>this.showToDo(t))),r.addEventListener("mouseout",(t=>this.showCurrToDo(t))),n.addEventListener("mouseleave",(()=>this.showCurrHalfOfDay())),n}},Z=class{constructor(t,e,n,i,s,a){this.id=t,this.radius=a,this.x=e,this.y=n,this.dx=i,this.dy=s}draw(t){t.beginPath(),t.arc(Math.round(this.x),Math.round(this.y),this.radius,0,2*Math.PI),[[t.fillStyle]]=a,t.fill(),t.closePath(),this.updateThoughtPos()}drawCircles(t){t.beginPath(),t.arc(Math.round(this.x),Math.round(this.y),this.radius,0,2*Math.PI),[[,t.fillStyle]]=a,t.fill(),t.closePath()}updateThoughtPos(){(this.x+this.radius>N.width||this.x-this.radius<0)&&(this.dx=-this.dx),(this.y+this.radius>N.height||this.y-this.radius<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy}getDistance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}thoughtCollision(t){for(let e=0;e<t.length-1;e+=1)for(let n=e+1;n<t.length;n+=1){const i=t[e],s=t[n];if(this.getDistance(i,s)<=i.radius+s.radius){const t=i.angle(),e=s.angle(),n=Math.atan2(s.y-i.y,s.x-i.x),a=i.speed(),o=s.speed(),r=o*Math.cos(e-n)*Math.cos(n)+a*Math.sin(t-n)*Math.cos(n+Math.PI/2),d=o*Math.cos(e-n)*Math.sin(n)+a*Math.sin(t-n)*Math.sin(n+Math.PI/2),l=a*Math.cos(t-n)*Math.cos(n)+o*Math.sin(e-n)*Math.cos(n+Math.PI/2),h=a*Math.cos(t-n)*Math.sin(n)+o*Math.sin(e-n)*Math.sin(n+Math.PI/2);i.dx=r,i.dy=d,s.dx=l,s.dy=h,this.staticCollision(i,s)}}}staticCollision(t,e,n=!1){const i=t.radius+e.radius-this.getDistance(t,e),s=t,a=Math.atan2(e.y-t.y,e.x-t.x);s.x-=i*Math.cos(a),s.y-=i*Math.sin(a),this.getDistance(t,e)<t.radius+e.radius&&!n&&this.staticCollision(t,e,!0)}speed(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}angle(){return Math.atan2(this.dy,this.dx)}};class q{constructor(t,e,n,i,s,a){this.canCreate=!0,this.goTo=t,this.editor=e,this.popup=n,this.fillWeekTime=i,this.thoughtText=s,this.thoughtId=a}async createThought(t){if(!t)return;this.canCreate=!1;const e=h(".thought__add");e.classList.remove("open"),e.classList.add("thought__add_hold");const n=t;this.thoughtText="",await I.createThoughts({title:n});const i=await I.getThoughts();this.createThoughtsList(h(".thought__container"),i),this.createFlyingThought(h(".canvas"),i),h(".thought__input").value=this.thoughtText,h(".canvas").classList.remove("none"),e.classList.remove("thought__add_hold"),this.canCreate=!0}async convertToPlan(t){this.openCloseThoughtList(c("thought__add"),c("blur")),this.fillWeekTime+15<=10080?this.editor.open(15,10080-this.fillWeekTime,4,void 0,void 0,this.thoughtId,t):(this.popup.editorMode(),this.popup.open(E("Less than 15 minutes left\n\n Free up your WEEK time")))}async updateThought(t,e){if(!l(e.target)||!e.target.parentElement)return;const n=e.target.parentElement.dataset.thoughtId;n&&await I.updateThought({_id:n,title:t})}async deleteThought(t){if(!l(t.target)||!t.target.parentElement)return;const e=t.target.parentElement,n=t.target.parentElement.dataset.thoughtId;if(e.classList.add("none"),setTimeout((()=>e.parentElement?.removeChild(e)),350),!n)return;await I.deleteThought(n);const i=await I.getThoughts();this.createFlyingThought(h(".canvas"),i)}openCloseThought(t,e){l(t.target)&&this.canCreate&&(t.target.closest(".open")?(e.classList.remove("open"),c("thought__add").classList.contains("none")||h(".canvas").classList.remove("none")):(e.classList.add("open"),t.target.closest(".thought__add")&&h(".canvas").classList.add("none")))}openCloseThoughtList(t,e){this.canCreate&&(t.classList.toggle("none"),e.classList.toggle("none"),document.querySelectorAll(".thought__item").forEach((e=>{t.classList.contains("none")?(e.classList.add("open"),t.classList.remove("open"),h(".canvas").classList.add("none")):h(".canvas").classList.remove("none"),e.classList.toggle("none")})))}async createThoughtsList(t,e){t.innerHTML="";const n=[];e.forEach((t=>{n.push(new q(this.goTo,this.editor,this.popup,this.fillWeekTime,t.title,t._id))}));for(let e=0;e<n.length;e+=1){const i=n[e].draw("thought__item");t.append(i)}}createFlyingThought(t,e){const n=t.getContext("2d"),i=[];if(e.forEach((t=>{const e=t._id;if(!e)return;const n=Math.random()*(N.width-40)+20,s=Math.random()*(N.height-40)+20,a=2*(Math.random()-.5),o=2*(Math.random()-.5);i.push(new Z(e,n,s,a,o,20))})),n){const t=()=>{requestAnimationFrame(t),n.clearRect(0,0,N.width,N.height);for(let t=0;t<i.length;t+=1)i[t].draw(n),i[t].thoughtCollision(i);this.updateHeight();const e=new Z("planCircle",N.planPosWidth,N.planPosHeight,1,1,100);n&&e.drawCircles(n);const s=new Z("clockCircle",N.clockPosWidth,N.clockPosHeight,1,1,330);n&&s.drawCircles(n),e.thoughtCollision([...i,e,s]),s.thoughtCollision([...i,e,s])};t()}}updateHeight(){const t=document.documentElement.clientHeight;N.height=t,N.planPosHeight=t/2-15,N.clockPosHeight=t/2-15}draw(t){const e=u("div",t),n=u("div","thought__add-btn");e.classList.add("none");const i=u("input","thought__input");i.value=this.thoughtText,void 0!==this.thoughtId&&e.setAttribute("data-thought-id",this.thoughtId.toString()),i.addEventListener("blur",(e=>{i.value&&(this.thoughtText=i.value,"thought__item"===t&&this.updateThought(this.thoughtText,e))}));const s=u("div","thought__create-btn");if(s.addEventListener("click",(()=>{"thought__item"===t?this.convertToPlan(this.thoughtText):this.createThought(this.thoughtText)})),e.append(i),n.addEventListener("click",(t=>this.openCloseThought(t,e))),"thought__item"===t){const t=u("div","thought__remove-btn");t.addEventListener("click",(t=>this.deleteThought(t))),e.append(t)}return e.append(s,n),e}}var G=q,z=class extends B{constructor(t,e,n){super("Home",t,e),this.clockChartInst=new U(this.goTo),this.userName="",this.confirmDayInfo=!1,this.confirmDay=0,this.confirmationTime=660,this.confirmDayPlans=[],this.daysInApp=1,this.commonPopup=n}createCanvas(){const t=u("canvas","canvas");return t.width=N.width,t.height=N.height,t}async createThought(t){const e=u("div","thought"),n=u("div","thought__container"),i=u("h3","thought__title");i.textContent="Thought";const[s,a]=await Promise.all([I.getThoughts(),I.getAllPlans()]),o=a.reduce(((t,e)=>t+e.duration),0),r=new G(this.goTo,this.editor,this.commonPopup,o,""),d=r.draw("thought__add");d.classList.remove("none"),e.append(i,d,n),r.createThoughtsList(n,s),r.createFlyingThought(t,s);const l=document.querySelector(".blur");if(l instanceof HTMLElement)i.addEventListener("click",(()=>r.openCloseThoughtList(d,l)));else{const t=u("div","blur");t.classList.add("none"),document.body.append(t),i.addEventListener("click",(()=>r.openCloseThoughtList(d,t))),t.addEventListener("click",(()=>{r.openCloseThoughtList(d,t),t.classList.contains("none")&&c("thought__add").classList.remove("none")}))}return e}async setUserInfo(){const t=await Promise.all([I.getUserProfile(),I.getConfirmDayInfo(),I.getWeekDistribution()]),[e,n,i]=t;this.userName=e.name,this.confirmDayInfo=n,this.confirmDay=this.getDayOfWeekByConfirmationDay(e.confirmationDay),this.confirmationTime=e.confirmationTime,this.confirmDayPlans=i[this.confirmDay],this.daysInApp=this.getDaysInApp(new Date(e.createdAt))}getDayOfWeekByConfirmationDay(t){const e=this.getPreviousDayOfWeek((new Date).getDay());return"today"===t?e:this.getPreviousDayOfWeek(e)}getPreviousDayOfWeek(t){return t-1<0?6:t-1}isValidDay(){return!(this.confirmDay===(new Date).getDay()-2&&1===this.daysInApp)}getDaysInApp(t){return Math.ceil((Date.now()-t.getTime())/1e3/3600/24)}async checkConfirmTime(t){this.isValidDay();const e=setInterval((()=>{"/"!==window.location.pathname&&clearTimeout(e),this.clockChartInst.minutes>=this.confirmationTime&&!1===this.confirmDayInfo&&this.confirmDayPlans.length&&this.isValidDay()?t.classList.add("show"):!0===this.confirmDayInfo&&t.classList.remove("show"),0===this.clockChartInst.seconds&&this.getNewDayData()}),1e3)}async getNewDayData(){const t=b(),e=await I.getDayDistribution(t.toString());this.clockChartInst.showNewDay(e.distributedPlans,t)}async getFilledPage(){const t=document.createElement("section"),e=b(),n=this.createCanvas(),[,i,s]=await Promise.all([this.setUserInfo(),this.createThought(n),I.getDayDistribution(e.toString())]),a=u("div","confirm-day");a.addEventListener("click",(()=>this.goTo("/confirm"))),this.checkConfirmTime(a);const o=u("div","plan-btn");o.textContent="Week",o.addEventListener("click",(()=>this.goTo("/plan")));const r=u("div","profile-btn");r.addEventListener("click",(()=>this.goTo("/profile"))),r.textContent=this.userName;const d=this.clockChartInst.draw(s.distributedPlans,e);return t.append(n,i,r,o,a,d),t}async draw(){const t=c("main__container");try{await this.animatedFilledPageAppend(t),this.clockChartInst.getTime()}catch{this.goTo("/login")}}},j=class{constructor(t,e){this.type=t,this.input=this.createInput(),this.errorBlock=this.createErrorBlock(),this.input.setAttribute("placeholder",e),this.errorText="Wrong value"}blurCheck(){this.input.value=this.input.value.trim();const t=this.isValueValid(this.input.value);return t||this.showError(),t}isValueValid(t){return!!t}inputCheck(){this.input.value=this.getCorrectValue(this.input.value),this.hideError()}getCorrectValue(t){return t}showError(t){this.errorBlock.innerHTML=this.errorText,t&&(this.errorBlock.innerHTML=t),this.errorBlock.classList.add("sign-form__input-error_active")}hideError(){this.errorBlock.classList.remove("sign-form__input-error_active")}createInput(){const t=document.createElement("input");return t.type=this.type,t.addEventListener("blur",(()=>this.blurCheck())),t.addEventListener("input",(()=>this.inputCheck())),t}createErrorBlock(){const t=document.createElement("span");return t.classList.add("sign-form__input-error"),t}draw(t,...e){this.input.classList.add("sign-form__input");const n=document.createElement("div");return n.classList.add("sign-form__input-box"),t&&n.classList.add(t),e.length>0&&e.forEach((t=>{this.input.classList.add(t)})),n.append(this.input,this.errorBlock),n}},X=class extends j{constructor(t){super("email",t),this.errorText="this is not email"}isValueValid(t){return/^[\w-.]+@[\w-]+\.[a-z]{2,4}$/i.test(t)}getCorrectValue(t){return t.slice(0,200)}},K=class extends j{constructor(t){super("text",t),this.maxValue=50,this.minValue=2,this.errorText="from 2 to 50 characters"}isValueValid(t){return t.length>=this.minValue&&t.length<=this.maxValue}getCorrectValue(t){return t.slice(0,this.maxValue)}},J=class extends j{constructor(t){super("password",t),this.errorText="from 4 characters",this.minValue=4}isValueValid(t){return t.length>=this.minValue}},Y=class extends j{constructor(t,e){super("password",t),this.firstPass=e,this.errorText="password mismatch"}isValueValid(t){return t===this.firstPass.input.value}},Q=class extends B{constructor(t,e){super("Login page",t,e),this.layout=new class{makeEmptyForm(){const t=document.createElement("div");return t.classList.add("sign-form","sign-form_sign-in"),t}makeTitle(t,e){const n=document.createElement("h1");return n.classList.add("sign-form__title",e),n.innerHTML=t,n}makeButton(){const t=document.createElement("button");t.classList.add("button","button_signIn","sign-form__button");const e=document.createElement("span");e.classList.add("sign-form__button-text","sign-in-view"),e.innerText="Sign In";const n=document.createElement("span");return n.classList.add("sign-form__button-text","sign-up-view"),n.innerText="Sign Up",t.append(e,n),t}makeTestButton(){const t=document.createElement("button");return t.classList.add("button","button_test-button"),t.innerText="Enter with test account",t}makeCheckbox(){const t=document.createElement("input");return t.type="checkbox",t.id="rememberMe",t.checked=!0,t}makeLabel(){const t=document.createElement("label");t.setAttribute("for","rememberMe"),t.classList.add("sign-form__label","sign-in-view");const e=document.createElement("div");e.classList.add("sign-form__big-o");const n=document.createElement("div");n.classList.add("sign-form__small-o"),e.append(n);const i=document.createElement("span");return i.innerHTML="Remember me",t.append(e,i),t}},this.status="Sign In",this.nameInput=new K("Name"),this.firstPasswordInput=new J("Password"),this.secondPasswordInput=new Y("Repeat password",this.firstPasswordInput),this.emailInput=new X("Email"),this.signButton=this.setLoginButton(this.layout.makeButton()),this.testButton=this.setTestButton(this.layout.makeTestButton()),this.checkbox=this.layout.makeCheckbox()}isFormValid(){const t=this.emailInput.blurCheck(),e=this.firstPasswordInput.blurCheck();if("Sign In"===this.status)return t&&e;const n=this.nameInput.blurCheck(),i=this.secondPasswordInput.blurCheck();return t&&e&&n&&i}async sendForm(){const t=this.nameInput.input.value,e=this.emailInput.input.value,n=this.firstPasswordInput.input.value,i=this.checkbox.checked;return"Sign In"===this.status?I.login({email:e,password:n,remember:i}):I.registration({name:t,email:e,password:n})}toggleFormClass(){const t=c("sign-form");t.classList.toggle("sign-form_sign-up"),t.classList.toggle("sign-form_sign-in")}toggleStatus(){switch(this.status){case"Sign In":this.status="Sign Up";break;case"Sign Up":this.status="Sign In"}}errorHandle(t){if("Sign In"===this.status)switch(t.message){case"404":this.emailInput.showError("cant't find this account");break;case"400":this.firstPasswordInput.showError("wrong password")}else"400"===t.message&&this.emailInput.showError("this user already exist")}setLoginButton(t){return t.addEventListener("click",(async()=>{if(this.isFormValid())try{p(this.signButton,this.testButton),await this.sendForm(),this.cleanForm(),this.status="Sign In",m(this.signButton,this.testButton),this.goTo("/")}catch(t){if(m(this.signButton,this.testButton),!(t instanceof Error))throw t;this.errorHandle(t)}})),t}setTestButton(t){return t.addEventListener("click",(async()=>{try{p(this.signButton,this.testButton),await I.login({email:"student1@school.rs",password:"student1",remember:!0}),this.cleanForm(),this.status="Sign In",m(this.signButton,this.testButton),this.goTo("/")}catch(t){if(m(this.signButton,this.testButton),!(t instanceof Error))throw t;this.errorHandle(t)}})),t}async getFilledPage(){const t=this.layout.makeEmptyForm();return t.append(this.layout.makeTitle("Sign In","sign-in-view"),this.layout.makeTitle("Sign Up","sign-up-view"),this.nameInput.draw("sign-up-view"),this.emailInput.draw(),this.firstPasswordInput.draw("sign-password"),this.secondPasswordInput.draw("sign-up-view","sign-password"),this.checkbox,this.layout.makeLabel(),this.makeLink("I need a new account","sign-in-view"),this.makeLink("I already have an account","sign-up-view"),this.signButton,this.testButton),t}cleanForm(){this.nameInput.input.value="",this.emailInput.input.value="",this.firstPasswordInput.input.value="",this.secondPasswordInput.input.value=""}cleanErrors(){this.nameInput.hideError(),this.emailInput.hideError(),this.firstPasswordInput.hideError(),this.secondPasswordInput.hideError()}makeLink(t,e){const n=document.createElement("span");return n.innerText=t,n.addEventListener("click",(()=>{this.toggleStatus(),this.toggleFormClass(),this.cleanErrors()})),n.classList.add("sign-form__link",e),n}},tt=class extends B{constructor(t,e){super("404 page",t,e)}async getFilledPage(){const t=document.createElement("section");t.classList.add("page-404");const e=document.createElement("h1");e.innerText=this.name,e.classList.add("page-404__title");const n=document.createElement("p");n.innerText="Sorry, didn't find that page...",n.classList.add("page-404__text");const i=document.createElement("button");return i.classList.add("button","button_main"),i.textContent="Home",i.addEventListener("click",(()=>this.goTo("/"))),t.append(e,n,i),t}},et=class{constructor(){this.minTime=15,this.maxTime=15,this.currentTime=15}setTimer(t,e,n){this.minTime=t>15?t:15,this.maxTime=e,this.currentTime=n||(e>60?60:this.minTime)}makeSlider(){const t=u("input","time-container__slider");return t.type="range",t.min=this.minTime.toString(),t.max=this.maxTime.toString(),t.value=this.currentTime.toString(),t}makeHoursInput(t){const e=u("input","time-container__time-input");return e.id=t,e.type="number",e}setTimeInterval(t,e,n){t.value=y(Number(n)).toString(),e.value=_(Number(n)).toString(),this.currentTime=Number(n)}setCorrectTimeInterval(t,e){const n=60*Number(t.value)+Number(e.value);n>this.maxTime&&this.setTimeInterval(t,e,this.maxTime),n<this.minTime&&this.setTimeInterval(t,e,this.minTime)}setSlider(t,e,n){const i=60*Number(e.value)+Number(n.value);t.value=i.toString(),this.currentTime=i}addListeners(t,e,n){return this.setTimeInterval(t,e,n.value),n.addEventListener("input",(()=>this.setTimeInterval(t,e,n.value))),t.addEventListener("input",(()=>{t.value=t.value.replace(/\D+/g,""),t.value.length>1&&"0"===t.value[0]&&(t.value=t.value.substring(1)),this.setSlider(n,t,e)})),e.addEventListener("input",(()=>{e.value=e.value.replace(/\D+/g,""),e.value=e.value.slice(0,2),Number(e.value)>59&&(e.value="59"),this.setSlider(n,t,e)})),t.addEventListener("blur",(()=>{this.setCorrectTimeInterval(t,e),""===t.value&&(t.value="0")})),e.addEventListener("blur",(()=>{e.value=e.value.padStart(2,"0"),this.setCorrectTimeInterval(t,e)})),{hours:t,minutes:e,slider:n}}makeLabel(t){const e=u("label","time-container__time-label");return e.innerText=t,e}weekHoursToDay(){return f(Math.floor(this.currentTime/7))}makePerSection(t,e,n,i){const s=u("span","time-container__per");if(2===i||0===i){const i=u("span","time-container__per-val");e.addEventListener("blur",(()=>{i.innerHTML=this.weekHoursToDay()})),t.addEventListener("blur",(()=>{i.innerHTML=this.weekHoursToDay()})),n.addEventListener("input",(()=>{i.innerHTML=this.weekHoursToDay()})),i.innerHTML=this.weekHoursToDay(),s.append("( ~ ",i,"/day)")}return s}draw(t){const e=u("div","time-container"),{hours:n,minutes:i,slider:s}=this.addListeners(this.makeHoursInput("Hours"),this.makeHoursInput("Minutes"),this.makeSlider());return e.append(n,this.makeLabel("Hours"),i,this.makeLabel("Minutes"),this.makePerSection(n,i,s,t),s),e}},nt=function(t,e){return`<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" class="${e}" viewBox="0 0 24 24" fill="none" stroke=${t} stroke-width="2" stroke-linecap="round" stroke-linejoin="round" > <path d="M22 11.08V12a10 10 0 11-5.93-9.14" /> <polyline points="22 4 12 14.01 9 11.01" /> </svg>`},it=class extends B{constructor(t,e,n){super("Week",t,n),this.popup=e,this.allPlans=[],this.planRounds=[],this.allPlansDist={},this.weekDistribution=[[]],this.layout=new W(t),this.header=new S(t),this.fillWeekTime=0,this.addDayListener=this.addDayListener.bind(this)}isFreeTimeInWeek(){return 10080-this.fillWeekTime>=15}ifFreeTimeInDay(t){return t>=15}getFreeDayMinutes(t){return 1440-this.weekDistribution[Number(t)].reduce(((t,e)=>t+e.duration),0)}getFreePlanMinutes(t){return t.duration-(this.allPlansDist[t._id]||0)}ifFreeTimeInPlan(t){return t>=15}getPlan(t){return this.allPlans.filter((e=>e._id===t))[0]}getCurrentDay(t){const{currentTarget:e}=t;if(!(e instanceof HTMLElement))throw new Error("Ups! This element is not found!");return e}getDragId(){const t=c("plan-round_drag").dataset.planId;if(t)return t;throw new Error("no id")}setPushPlanData(t,e,n){return{dayOfWeek:Number(e),planId:t._id,duration:n.currentTime}}async pushPlanToThisDay(t,e,n,i){const s=this.setPushPlanData(e,n,i),{currentTarget:a}=t;if(!(a instanceof HTMLButtonElement))throw new Error("Ups! This element is not button!");p(a),this.popup.editorModeOff();try{this.popup.easyClose(),c("main__container").classList.add("main__container_hide"),await I.pushPlanToDay(s),this.goTo("/plan")}catch(t){t instanceof Error&&"401"===t.message&&this.goTo("/login")}}makeSliderForDay(t,e,n,i){const[s,a]=M(e.color),o=u("div","slider-popup");o.style.background=s;const r=document.createElement("button");r.classList.add("editor__button"),o.style.color=a,r.innerHTML=nt(a,"editor__save-icon");const d=new et;return d.setTimer(15,Math.min(n,i)),r.addEventListener("click",(async n=>this.pushPlanToThisDay(n,e,t,d))),o.append(d.draw(),r),o}addListenersToAllDays(t){document.querySelectorAll(".plan__day").forEach((e=>{e instanceof HTMLElement&&t(e)}))}addDayListener(t){t.addEventListener("dragover",(function(t){t.preventDefault(),this.classList.add("plan__day_over")})),t.addEventListener("dragleave",(function(){this.classList.remove("plan__day_over")})),t.addEventListener("drop",(async t=>{t.stopPropagation(),t.preventDefault();const e=this.getCurrentDay(t);e.classList.remove("plan__day_over");const n=e.dataset.dayId,i=this.getDragId();if(!n||!i)throw new Error("no id");const s=this.getPlan(i),a=this.getFreeDayMinutes(n),o=this.getFreePlanMinutes(s);this.popup.editorMode(),this.ifFreeTimeInDay(a)?this.ifFreeTimeInPlan(o)?this.popup.open(this.makeSliderForDay(n,s,a,o)):this.popup.open(E("This plan is fully distributed")):this.popup.open(E("Less than 15 minutes left\n\n Free up your WEEK time"))}))}setAddButton(){c("plan__button-add").addEventListener("click",(()=>{this.isFreeTimeInWeek()?this.editor.open(15,10080-this.fillWeekTime,2):(this.popup.editorMode(),this.popup.open(E("Less than 15 minutes left\n\n Free up your WEEK time")))}))}makePlans(){this.planRounds=[],this.planRounds=this.allPlans.map((t=>new H(t)))}setPlanDistTime(){const t=this.weekDistribution.flat();this.allPlansDist=t.reduce(((t,e)=>(t[e._id]?t[e._id]+=e.duration:t[e._id]=e.duration,t)),{})}showElements(){setTimeout((()=>{c("plan__button-add").classList.add("scale-normal"),c("plan__remove").classList.add("scale-normal"),c("plan__week-line").childNodes.forEach((t=>{t instanceof HTMLDivElement&&t.classList.add("scale-normal")})),document.querySelectorAll(".plan-round").forEach((t=>{t instanceof HTMLDivElement&&t.classList.add("scale-normal")})),document.querySelectorAll(".plan__day-line").forEach((t=>{t instanceof HTMLDivElement&&t.childNodes.forEach((t=>{t instanceof HTMLDivElement&&t.classList.add("scale-normal")}))}))}),0)}fillPlansFields(){const t=c("week-fields__big"),e=c("week-fields__small"),n=.45*t.clientWidth;this.planRounds.forEach(((i,s)=>{const a=i.planInfo.duration/4110;let o=(n-70)*a+70;o<70&&(o=70),o>n&&(o=n),i.setWidth(o);const r=this.addRoundListener(i);(s%2==0?t:e).append(r)}))}addRoundListener(t){const e=this.allPlansDist[t.planInfo._id]||0,n=t.draw();t.paintRound(e),n.addEventListener("click",(()=>{this.editor.open(e,t.planInfo.duration+10080-this.fillWeekTime,0,t.planInfo)}));const i=c("plan__days"),s=c("plan__remove");return n.addEventListener("dragstart",(function(t){const{icon:e,center:n}=k(this);t.dataTransfer&&t.dataTransfer.setDragImage(e,n,n),this.classList.add("plan-round_drag"),s.classList.add("plan__remove_drag"),i.classList.add("plan__days_drag")})),n.addEventListener("dragend",(function(){this.classList.remove("plan-round_drag"),s.classList.remove("plan__remove_drag"),i.classList.remove("plan__days_drag")})),n}fillDays(){document.querySelectorAll(".plan__day").forEach(((t,e)=>{if(t.firstChild instanceof HTMLElement){const n=g(this.weekDistribution[e]),i=this.fillLine(t.firstChild,n,1440,!0);t.lastChild instanceof HTMLElement&&(t.lastChild.innerHTML=f(1440-i))}}))}fillLine(t,e,n,i){t.innerHTML="";const s=(i?t.clientHeight:t.clientWidth)/n;return e.reduce(((e,n)=>{const a=document.createElement("div");return a.style.height=i?n.duration*s+"px":"100%",a.style.width=i?"100%":n.duration*s+"px",[a.style.backgroundColor]=M(n.color),t.append(a),e+n.duration}),0)}fillWeekLine(){const t=c("plan__week-line"),e=g(this.allPlans),n=this.fillLine(t,e,10080,!1);this.fillWeekTime=n,c("plan__text-value").innerText=f(n),c("plan__button-add-value").innerText=f(10080-n)}async setWeekInfo(){const t=await Promise.all([I.getAllPlans(),I.getWeekDistribution()]);[this.allPlans,this.weekDistribution]=t}async getFilledPage(){await this.setWeekInfo(),this.makePlans();const t=u("section","plan");return t.append(this.header.draw("Week","week",this.layout.makeInfoText(" / 168 h")),this.layout.makeWeekLine(),this.layout.makePlanBody()),t}async draw(){try{const t=c("main__container");await this.animatedFilledPageAppend(t),this.fillWeekLine(),this.setPlanDistTime(),this.fillPlansFields(),this.fillDays(),this.showElements(),this.setAddButton(),this.addListenersToAllDays(this.addDayListener)}catch(t){this.goTo("/login")}}},st=class extends C{makeUserData(t){const e=document.createElement("div");return e.classList.add("user-data"),e.append(this.makeUserGreeting(t)),e.append(this.makeUserSettings(t)),e}makeStatistics(t){const e=document.createElement("div");e.classList.add("statistics");const n=this.getStatisticsTanks(t);return e.append(this.makeStatisticsTank(n[1],"Underfulfilled")),e.append(this.makeStatisticsTank(n[0],"Fulfilled")),e.append(this.makeStatisticsTank(n[2],"Overfulfilled")),e}getUserSettings(){let t="greeting__user-name";const e=c(t);t=".settings__confirm-day>.button";const n=h(t);t=".settings__confirm-time>.button";const i=h(t);var s;return{name:e.value,confirmationDay:n.textContent||"today",confirmationTime:(s=i.value,60*+s.slice(0,2)+ +s.slice(3))}}makeUserGreeting(t){const e=this.getDayOfAppUsing(new Date(t.createdAt)),n=document.createElement("div");return n.classList.add("greeting"),n.innerHTML=`\n      <h1 class="greeting__hello title">\n        Hello, <input class="greeting__user-name" type="text" maxlength="30"\n          value="${t.name}" placeholder="Anonymous"></input>\n      </h1>\n      <p class="greeting__info">This is your ${e} day in this app</p>`,n}makeUserSettings(t){const e=this.getFormattedTime(t.confirmationTime),n=document.createElement("div");return n.classList.add("settings"),n.innerHTML=`\n    <div class="settings__confirm-day">\n      <span class="settings__label">Confirm day</span>\n      <button class="\n        button\n        settings__button\n        settings__button_capitalized">${t.confirmationDay}</button>\n    </div>\n    <div class="settings__confirm-time">\n      <span class="settings__label">Confirm time</span>\n      <input class="\n        button\n        settings__input" type="time" value="${e}"></input>\n    </div>\n    <div class="settings__log-out">\n      <button class="\n        button\n        settings__button">Log out</button>\n    </div>`,n}makeStatisticsTank(t,e){const n=document.createElement("div");let i;switch(n.classList.add("statistics-tank"),i=document.createElement("div"),i.classList.add("statistics-tank__name"),e){case"Fulfilled":i.classList.add("fulfilled");break;case"Underfulfilled":i.classList.add("underfulfilled");break;case"Overfulfilled":i.classList.add("overfulfilled")}return i.textContent=e,n.append(i),i=document.createElement("div"),i.classList.add("statistics-tank__content",e.toLowerCase()),t.forEach((t=>i.append(this.makeStatisticsPlan(t)))),n.append(i),n}makeStatisticsPlan(t){const e=P(t.title,20),n=document.createElement("div"),[i,s]=M(t.color);return n.classList.add("plan-square"),n.style.backgroundColor=i,n.style.color=s,n.innerHTML=`\n      <div class="plan-square__name">${e}</div>\n      <div class="plan-square__deviation">${t.deviation} min/d</div>`,n}getDayOfAppUsing(t){return Math.ceil((Date.now()-t.getTime())/1e3/3600/24)}getStatisticsTanks(t){return t.reduce(((t,e)=>{switch(!0){case e.deviation>15:return t[2].push(e),t;case e.deviation<-15:return t[1].push(e),t;default:return t[0].push(e),t}}),[[],[],[]])}getFormattedTime(t){return`${y(t).toString().padStart(2,"0")}:${_(t)}`}},at=class extends B{constructor(t,e){super("Profile",t,e),this.profile={},this.statistics=[],this.layout=new st,this.header=new S(t)}async setProfileInfo(){[this.profile,this.statistics]=await Promise.all([I.getUserProfile(),I.getStatistics()])}setEventListeners(){c("greeting__user-name").addEventListener("input",(()=>this.activateSaveButton()));let t=".settings__confirm-day>.button";const e=h(t);e.addEventListener("click",(()=>this.changeConfirmationDay(e))),t=".settings__confirm-time>.button",h(t).addEventListener("change",(()=>this.activateSaveButton())),t=".settings__log-out>.button",h(t).addEventListener("click",(()=>this.logOut()))}changeConfirmationDay(t){t.textContent=this.toggleConfirmationDay(t.textContent||"today"),this.activateSaveButton()}toggleConfirmationDay(t){return"today"===t?"yesterday":"today"}async logOut(){await I.logout(),w(new Error("401"),this.goTo)}activateSaveButton(){this.layout.makeSaveButton(this.save.bind(this))}async save(){this.layout.disableSaveButton();const t=this.layout.getUserSettings();await I.saveUserSettings(t),this.layout.removeSaveButton()}async getFilledPage(){await this.setProfileInfo();const t=document.createElement("section");t.classList.add("profile");const e=document.createElement("div");return e.classList.add("profile-wrapper"),e.append(this.layout.makeUserData(this.profile),this.layout.makeStatistics(this.statistics)),t.append(this.header.draw("Profile","profile"),e),t}async draw(){try{const t=c("main__container");await this.animatedFilledPageAppend(t),this.setEventListeners()}catch(t){w(t,this.goTo)}}},ot=class extends C{makeHeader(){const t=document.createElement("div");return t.classList.add("confirm-header"),t.innerHTML='\n      <h1 class="\n        title \n        confirm-header__greeting">Confirm day</h1>\n      <p class="confirm-header__info">Drag the edge to change the time</p>',t}makeConfirmContent(t,e){const n=document.createElement("div");n.classList.add("confirm-content");const i=u("h2","subtitle");return i.innerHTML=d[e],t.length?n.append(i,this.makeConfirmPlans(t),this.makeConfirmButton()):n.append(i,this.makeNoPlansMessage()),n}makeNoPlansMessage(){const t=document.createElement("div");t.classList.add("confirm-content__message");const e=u("div","confirm-content__message-text");return e.textContent="There is no plans to confirm",t.append(e),t}makeConfirmPlans(t){const e=document.createElement("div");return e.classList.add("confirm-plans"),t.forEach((t=>e.append(this.makeConfirmPlan(t)))),e}makeConfirmPlan(t){const e=document.createElement("div");e.classList.add("confirm-plan"),e.dataset.id=t._id;const n=P(t.title,20),[i]=M(t.color);return e.innerHTML=`\n      <span class="confirm-plan__label">${n}</span>\n      <div class="\n        plan-square\n        confirm-plan__line" style="background-color: ${i};">\n        <div class="confirm-plan__arrows">\n          <img class="\n            confirm-plan__arrow\n            confirm-plan__arrow_left" src="./assets/svg/arrow-left.svg" alt="Left">\n          <img class="\n            confirm-plan__arrow\n            confirm-plan__arrow_right" src="./assets/svg/arrow-right.svg" alt="Right">\n        </div>\n      </div>\n      <span class="confirm-plan__time">${f(t.duration)}</span>`,e}makeConfirmButton(){const t=u("button","button");return t.classList.add("confirm__main-button"),t.innerHTML="Confirm!",t}makeConfirmationBanner(t,e){const n=document.createElement("div");n.classList.add("banner","banner_warning");const i=document.createElement("h2");i.classList.add("banner__title"),i.innerText="This day is confirmed\nConfirm it again?",n.append(i);const s=document.createElement("div");s.classList.add("banner__buttons");const a=document.createElement("button");a.classList.add("button","banner__button"),a.innerHTML="Yes",a.addEventListener("click",(()=>t())),s.append(a);const o=document.createElement("button");return o.classList.add("button","banner__button"),o.innerHTML="Cancel",o.addEventListener("click",(()=>e())),s.append(o),n.append(s),n}},rt=class extends B{constructor(t,e){super("Confirm",t,e),this.dayPlans=[],this.dayOfWeek=0,this.isDayConfirmed=!1,this.popup=new x,this.layout=new ot,this.header=new S(t)}async setConfirmInfo(){let t={},e=[];[t,e,this.isDayConfirmed]=await Promise.all([I.getUserProfile(),I.getWeekDistribution(),I.getConfirmDayInfo()]),this.dayOfWeek=this.getDayOfWeekByConfirmationDay(t.confirmationDay),this.dayPlans=e[this.dayOfWeek]}setEventListeners(){c("confirm__main-button").addEventListener("click",(()=>this.confirm()));const t=c("confirm-plans");t.addEventListener("mousedown",(t=>this.startMove(t))),t.addEventListener("click",(t=>this.changeTime(t)))}startMove(t){const e=t.target;if(!e.classList.contains("plan-square"))return;const n=this,i=e.getBoundingClientRect();function s(t){const s=e.closest(".confirm-plan"),a=n.dayPlans.find((t=>t._id===s.dataset.id));let o=t.x-i.x+5;o=n.restrictPlanWidth(a,o),e.style.width=`${o}px`,a.duration=n.getDurationByWidth(o),a.duration=n.restrictPlanDuration(a,a.duration),e.nextElementSibling.textContent=f(a.duration)}document.addEventListener("mousemove",s),document.onmouseup=function(){document.removeEventListener("mousemove",s),document.onmouseup=null}}changeTime(t){const e=t.target;e.classList.contains("confirm-plan__arrow_left")?this.changePlanTime(e,-1):e.classList.contains("confirm-plan__arrow_right")&&this.changePlanTime(e,1)}getMinMaxWidth(){return[55,775]}getPlanMaxDuration(t){return 1440-this.dayPlans.reduce(((t,e)=>t+e.duration),0)+t.duration}getWidthByDuration(t){const[e,n]=this.getMinMaxWidth();return Math.round(t*(n-e)/1440)+e}restrictPlanWidth(t,e){let n=e;const[i,s]=this.getMinMaxWidth(),a=this.getPlanMaxDuration(t),o=i+Math.round(a*(s-i)/1440);return n=n>o?o:n,n=n>s?s:n,n=n<i?i:n,n}getDurationByWidth(t){const[e,n]=this.getMinMaxWidth();return Math.round(1440*(t-e)/(n-e))}restrictPlanDuration(t,e){let n=e;const i=this.getPlanMaxDuration(t);return n=n<0?0:n,n=n>i?i:n,n}changePlanTime(t,e){const n=t.closest(".confirm-plan"),i=this.dayPlans.find((t=>t._id===n.dataset.id));i.duration+=e,i.duration=this.restrictPlanDuration(i,i.duration);let s=this.getWidthByDuration(i.duration);s=this.restrictPlanWidth(i,s);const a=t.closest(".confirm-plan__line");a.style.width=`${s}px`,a.nextElementSibling.textContent=f(i.duration)}setPageElementsParameters(){this.dayPlans.forEach((t=>{const e=h(`.confirm-plan[data-id="${t._id}"]`);let n=this.getWidthByDuration(t.duration);n=this.restrictPlanWidth(t,n),c("confirm-plan__line",e).style.width=`${n}px`}))}async getFilledPage(){await this.setConfirmInfo();const t=document.createElement("section");t.classList.add("confirm");const e=document.createElement("div");return e.classList.add("confirm-wrapper"),e.append(this.layout.makeHeader(),this.layout.makeConfirmContent(this.dayPlans,this.dayOfWeek)),t.append(this.header.draw("Confirm","confirm"),e),t}async draw(){try{const t=c("main__container");await this.animatedFilledPageAppend(t),this.setPageElementsParameters(),this.setEventListeners()}catch(t){w(t,this.goTo)}}confirm(){let t;const e=async()=>{try{t=this.layout.makeBanner("warning","Waiting..."),this.popup.open(t),await this.confirmDay(),t=this.layout.makeBanner("success","Confirmed!"),this.popup.open(t),setTimeout((()=>{document.location.href="./"}),1e3)}catch(e){t=this.layout.makeBanner("error","Ooops! Something went wrong..."),this.popup.editorMode(),this.popup.open(t)}};this.isDayConfirmed?(t=this.layout.makeConfirmationBanner(e,(()=>{this.popup.easyClose()})),this.popup.open(t)):e()}async confirmDay(){const t={dayOfWeek:this.dayOfWeek,dayDistribution:[]};this.dayPlans.forEach((e=>{const n={planId:e._id,duration:e.duration};t.dayDistribution.push(n)})),await I.confirmDay(t),this.isDayConfirmed=!0}getDayOfWeekByConfirmationDay(t){const e=this.getPreviousDayOfWeek((new Date).getDay());return"today"===t?e:this.getPreviousDayOfWeek(e)}getPreviousDayOfWeek(t){return t-1<0?6:t-1}};class dt{constructor(t){this.editor=new class{constructor(t,e){this.dayId="",this.thoughtId="",this.oldDur=0,this.goTo=e,this.mode=2,this.popup=t,this.plan={...A},this.open=this.open.bind(this),this.slider=new et,this.saveToLocalStorage=this.saveToLocalStorage.bind(this),this.sendPlan=this.sendPlan.bind(this)}open(t,e,n,i,s,a,o){switch(this.mode=n,this.dayId="",this.slider.setTimer(t,e,i?.duration),this.mode){case 0:i&&(this.plan={...i}),this.popup.editorMode();break;case 1:i&&(this.plan={...i}),i&&(this.oldDur={...i}.duration),s&&(this.dayId=s),this.popup.editorMode();break;case 2:this.popup.editorMode(this.saveToLocalStorage),this.loadToLocalStorage();break;case 4:this.popup.editorMode(),this.loadToLocalStorage(),o&&(this.plan.title=o),a&&(this.thoughtId=a);break;case 3:s&&(this.dayId=s),this.popup.editorMode(this.saveToLocalStorage),this.loadToLocalStorage()}this.drawEditor()}loadToLocalStorage(){const t=localStorage.getItem(`new-plan-save/${this.dayId}`);t?this.plan=JSON.parse(t):(this.plan={...A},this.plan.color=this.getRandomColorId())}async sendPlan(){this.setPlan();const{_id:t,title:e,text:n,color:i,duration:s}=this.plan,a={dayOfWeek:Number(this.dayId),planId:this.plan._id,duration:this.plan.duration-this.oldDur};switch(this.mode){case 2:await I.createNewPlan({title:e,text:n,color:i,duration:s}),localStorage.removeItem(`new-plan-save/${this.dayId}`);break;case 4:await I.convertToPlan({title:e,text:n,color:i,duration:s},this.thoughtId);break;case 0:await I.editPlan({_id:t,title:e,text:n,color:i,duration:s});break;case 1:await I.editPlan({_id:t,title:e,text:n,color:i}),await I.pushPlanToDay(a);break;case 3:const o=await I.createNewPlan({title:e,text:n,color:i,duration:s});await I.pushPlanToDay({dayOfWeek:Number(this.dayId),planId:o._id,duration:o.duration}),localStorage.removeItem(`new-plan-save/${this.dayId}`)}}saveToLocalStorage(){this.setPlan(),localStorage.setItem(`new-plan-save/${this.dayId}`,JSON.stringify(this.plan))}setPlan(){this.plan.duration=this.slider.currentTime,this.plan.title=function(t,e=document){const n=e.querySelector(t);if(null===n)throw new Error("Ups! This element is not found!");if(!(n instanceof HTMLInputElement))throw new Error("Ups! This element is not input!");return n}(".editor__title").value;const t=document.querySelector(".editor__text");t instanceof HTMLTextAreaElement&&(this.plan.text=t.value)}getRandomColorId(){const t=a.length;return(Math.floor(Math.random()*(t-1))+1).toString()}drawEditor(){const[t,e]=M(this.plan.color),n=this.makeContainer(t,e),i=u("div","editor__tools");i.append(this.makeAcceptButton(e),this.colorPicker(),this.makeColorBox(),this.slider.draw(this.mode)),n.append(i,this.makeTitle(),this.makeText()),this.popup.open(n)}makeContainer(t,e){const n=u("div","editor");return n.style.backgroundColor=t,n.style.color=e,n}makeTitle(){const t=document.createElement("input");return t.classList.add("editor__title"),t.value=this.plan.title,t.addEventListener("blur",(function(){this.value=this.value.trim()})),t.addEventListener("blur",(t=>{const{target:e}=t;e instanceof HTMLInputElement&&""===e.value&&(e.value="Plan for ...")})),t.addEventListener("focus",(t=>{const{target:e}=t;e instanceof HTMLInputElement&&"Plan for ..."===e.value&&(e.value="")})),t}makeText(){const t=document.createElement("textarea");return t.classList.add("editor__text"),t.value=this.plan.text,t}makeAcceptButton(t){const e=document.createElement("button");return e.classList.add("editor__button"),e.innerHTML=nt(t,"editor__save-icon"),e.addEventListener("click",(async t=>{const{currentTarget:e}=t;if(!(e instanceof HTMLButtonElement))throw new Error("Ups! This element is not button!");p(e);try{this.popup.easyClose(),c("main__container").classList.add("main__container_hide"),await this.sendPlan(),this.goTo(this.dayId?`/${d[Number(this.dayId)]}`:"/plan")}catch(t){this.popup.easyClose(),w(t,this.goTo)}})),e}colorPicker(){const t=u("div","editor__color-picker");return t.addEventListener("click",(()=>this.toggleColorBox())),t}makeColorBox(){const t=u("div","editor__color-box");return a.forEach(((e,n)=>{0!==n&&t.append(this.makeColorRound(n.toString()))})),t}makeColorRound(t){const[e]=M(t),n=u("div","editor__color-round");return n.style.backgroundColor=e,n.setAttribute("data-picker-color",t),n.addEventListener("click",(()=>this.toggleColorBox())),n.addEventListener("click",(t=>this.changeColor(t))),n}changeColor(t){const{target:e}=t;if(e instanceof HTMLElement){const t=e.dataset.pickerColor;t&&(this.plan.color=t,this.paintEditor(t))}}paintEditor(t){const[e,n]=M(t),i=c("editor");i.style.backgroundColor=e,i.style.color=n,c("editor__save-icon").style.stroke=n}toggleColorBox(){c("editor__color-box").classList.toggle("editor__color-box_active")}}(t,this.goTo),dt.homePage=new z(this.goTo,this.editor,t),dt.planPage=new it(this.goTo,t,this.editor),dt.loginPage=new Q(this.goTo,this.editor),dt.dayPage=new O(this.goTo,t,this.editor),dt.profilePage=new at(this.goTo,this.editor),dt.confirmPage=new rt(this.goTo,this.editor),dt.notFoundPage=new tt(this.goTo,this.editor)}static async render(t){switch(t){case"/plan":await dt.planPage.draw();break;case"/login":await dt.loginPage.draw();break;case"/":await dt.homePage.draw();break;case"/profile":await dt.profilePage.draw();break;case"/confirm":await dt.confirmPage.draw();break;default:T(t)?dt.dayPage.draw(T(t)):dt.notFoundPage.draw()}}goTo(t){window.history.pushState({pageName:t},t,t),dt.render(t),window.scrollTo(0,0)}async startRouter(){window.addEventListener("popstate",(()=>{dt.render(new URL(window.location.href).pathname)}));const t=new URL(window.location.href).pathname;await dt.render(t)}}var lt=dt;(new class{constructor(){this.popup=new x,this.router=new lt(this.popup)}start(){this.router.startRouter()}}).start()}()}();