(()=>{"use strict";var e={230:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=new Map;n.set("port",5100),n.set("dbUrl","mongodb+srv://mikalai-kazlou:Uu8rYNJbgMWpApXp@cluster0.caeg4ek.mongodb.net/?retryWrites=true&w=majority"),n.set("allowedOrigins",["http://localhost:8080","https://lexarudak-rsclone.netlify.app"]),n.set("jwtSecretKey","jwt-secret-key-rs-school"),n.set("tokenExpiresInShort",864e5),n.set("tokenExpiresInLong",6048e5),t.default=n},202:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(230));t.default=function(e,t,n){const i=e.headers.origin||"";r.default.get("allowedOrigins").includes(i)&&(t.header("Access-Control-Allow-Origin",i),t.header("Access-Control-Allow-Credentials","true"),t.header("Access-Control-Allow-Methods","GET,POST,DELETE,OPTIONS"),t.header("Access-Control-Allow-Headers","Content-Type")),n()}},712:(e,t)=>{var n,i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorMessages=t.StatusCodes=t.Constants=t.ConfirmationDays=void 0,(o=t.ConfirmationDays||(t.ConfirmationDays={})).today="today",o.yesterday="yesterday",(r=t.Constants||(t.Constants={})).tokenDescription="rs-clone-user-token",r.defaultConfirmationDay="yesterday",r[r.defaultConfirmationTime=660]="defaultConfirmationTime",(i=t.StatusCodes||(t.StatusCodes={}))[i.BadRequest=400]="BadRequest",i[i.Unauthorized=401]="Unauthorized",i[i.NotFound=404]="NotFound",i[i.InternalServerError=500]="InternalServerError",(n=t.ErrorMessages||(t.ErrorMessages={})).e1001="Invalid password",n.e1002="No authorization data",n.e1003="Invalid JWT token",n.e1004="No user ID in JWT token",n.e1005="No user with received authorization data",n.e1006="The user is unauthorized",n.e2001="ID not specified",n.e2002="Incorrect value of parameter",n.e2003="Incorrect value of period"},96:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientError=t.ServerError=void 0;const d=o(n(712));class u extends Error{constructor(e,t=d.StatusCodes.InternalServerError){super(e),this.name="ServerError",this.statusCode=t}}t.ServerError=u;class a extends Error{constructor(e,t=d.StatusCodes.BadRequest){super(e),this.name="ClientError",this.statusCode=t}}t.ClientError=a},341:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(860)),o=n(553),d=i(n(166)),u=i(n(18)),a=i(n(250)),s=i(n(472)),l=i(n(75)),c=i(n(956)),f=(0,r.default)(),h=[(0,o.check)("email","Incorrect email").isEmail(),(0,o.check)("password","Password must be at least 3 characters long").isLength({min:3})];f.get("/users",d.default.get.bind(d.default)),f.delete("/users/:id",d.default.delete.bind(d.default)),f.get("/users/profile",d.default.profile.bind(d.default)),f.post("/users/registration",h,d.default.create.bind(d.default)),f.post("/users/login",d.default.login.bind(d.default)),f.post("/users/logout",d.default.logout.bind(d.default)),f.post("/users/update",d.default.update.bind(d.default)),f.get("/thoughts",u.default.get.bind(u.default)),f.get("/thoughts/:id",u.default.getById.bind(u.default)),f.post("/thoughts",u.default.create.bind(u.default)),f.post("/thoughts/update",u.default.update.bind(u.default)),f.post("/thoughts/convertToPlan/:id",u.default.convertToPlan.bind(u.default)),f.delete("/thoughts/:id",u.default.delete.bind(u.default)),f.get("/plans",a.default.get.bind(a.default)),f.get("/plans/:id",a.default.getById.bind(a.default)),f.post("/plans",a.default.create.bind(a.default)),f.post("/plans/update",a.default.update.bind(a.default)),f.delete("/plans/:id",a.default.delete.bind(a.default)),f.get("/weekDistribution/get",s.default.get.bind(s.default)),f.post("/weekDistribution/adjustPlan",s.default.adjustPlan.bind(s.default)),f.get("/dayDistribution/get/:dayOfWeek",l.default.get.bind(l.default)),f.post("/dayDistribution/adjustPlan",l.default.adjustPlan.bind(l.default)),f.get("/statistics/get",c.default.get.bind(c.default)),f.get("/statistics/isDayConfirmed",c.default.isDayConfirmed.bind(c.default)),f.post("/statistics/confirmDay",c.default.confirmDay.bind(c.default)),t.default=f},293:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},d=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=u(n(344)),s=u(n(230)),l=n(96),c=o(n(712)),f=u(n(4));t.default=class{handleWithAuthorization(e,t,n){return d(this,void 0,void 0,(function*(){try{const i=yield this.getUserId(e),r=yield n(i);t.json(r)}catch(e){this.error(t,e)}}))}getUserId(e){return d(this,void 0,void 0,(function*(){try{const t=e.cookies[c.Constants.tokenDescription];if(!t)throw new l.ClientError(c.ErrorMessages.e1002,c.StatusCodes.Unauthorized);const n=a.default.verify(t,s.default.get("jwtSecretKey"));if(!n)throw new l.ClientError(c.ErrorMessages.e1003,c.StatusCodes.Unauthorized);const i=n;if(!i.id)throw new l.ClientError(c.ErrorMessages.e1004,c.StatusCodes.Unauthorized);const r=yield f.default.findById(i.id);if(!r)throw new l.ClientError(c.ErrorMessages.e1005,c.StatusCodes.Unauthorized);return r._id}catch(e){throw e instanceof Error?new l.ClientError(`${c.ErrorMessages.e1006} (${e.message})`,c.StatusCodes.Unauthorized):e}}))}error(e,t){if(t instanceof l.ClientError||t instanceof l.ServerError)e.status(t.statusCode).json(t.message);else{if(!(t instanceof Error))throw t;e.status(c.StatusCodes.InternalServerError).json(t.message)}}}},75:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(293)),d=r(n(312));class u extends o.default{get(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield d.default.get(t,+e.params.dayOfWeek)}))))}))}adjustPlan(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield d.default.adjustPlan(t,e.body)}))))}))}}t.default=new u},250:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(185),d=r(n(293)),u=r(n(659));class a extends d.default{get(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(e=>i(this,void 0,void 0,(function*(){return yield u.default.get(e)}))))}))}getById(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.getById(t,new o.Types.ObjectId(e.params.id))}))))}))}create(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.create(t,e.body)}))))}))}update(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.update(t,e.body)}))))}))}delete(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.delete(t,new o.Types.ObjectId(e.params.id))}))))}))}}t.default=new a},956:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(293)),d=r(n(814));class u extends o.default{get(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(e=>i(this,void 0,void 0,(function*(){return yield d.default.get(e)}))))}))}confirmDay(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield d.default.confirmDay(t,e.body)}))))}))}isDayConfirmed(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(e=>i(this,void 0,void 0,(function*(){return yield d.default.isDayConfirmed(e)}))))}))}}t.default=new u},18:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(185),d=r(n(293)),u=r(n(241));class a extends d.default{get(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(e=>i(this,void 0,void 0,(function*(){return yield u.default.get(e)}))))}))}getById(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.getById(t,new o.Types.ObjectId(e.params.id))}))))}))}create(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.create(t,e.body)}))))}))}update(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.update(t,e.body)}))))}))}convertToPlan(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.convertToPlan(t,new o.Types.ObjectId(e.params.id),e.body)}))))}))}delete(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield u.default.delete(t,new o.Types.ObjectId(e.params.id))}))))}))}}t.default=new a},166:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},d=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(553),s=n(185),l=u(n(293)),c=u(n(105)),f=u(n(230)),h=o(n(712));class y extends l.default{get(e,t){return d(this,void 0,void 0,(function*(){try{const e=yield c.default.get();t.json(e)}catch(e){this.error(t,e)}}))}delete(e,t){return d(this,void 0,void 0,(function*(){try{const n=yield c.default.delete(new s.Types.ObjectId(e.params.id));t.json(n)}catch(e){this.error(t,e)}}))}create(e,t){var n,i;return d(this,void 0,void 0,(function*(){try{const r=(0,a.validationResult)(e);if(!r.isEmpty())return void t.status(h.StatusCodes.BadRequest).json(null===(n=r.array().at(0))||void 0===n?void 0:n.msg);const o=e.body;o.createdAt=new Date,yield c.default.create(o);const d=e.body,u=yield c.default.login(d);this.setJwtToken(t,u.token,null===(i=e.body)||void 0===i?void 0:i.remember),t.json(u)}catch(e){this.error(t,e)}}))}login(e,t){var n;return d(this,void 0,void 0,(function*(){try{const i=yield c.default.login(e.body),r=(null===(n=e.body)||void 0===n?void 0:n.remember)?f.default.get("tokenExpiresInLong"):f.default.get("tokenExpiresInShort");this.setJwtToken(t,i.token,r),t.json(i)}catch(e){this.error(t,e)}}))}logout(e,t){return d(this,void 0,void 0,(function*(){try{this.setJwtToken(t,"",-1),t.json(null)}catch(e){this.error(t,e)}}))}profile(e,t){return d(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(e=>d(this,void 0,void 0,(function*(){return yield c.default.getById(e)}))))}))}update(e,t){return d(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>d(this,void 0,void 0,(function*(){return yield c.default.update(t,e.body)}))))}))}setJwtToken(e,t,n){e.cookie(h.Constants.tokenDescription,t,{maxAge:n,httpOnly:!0,secure:!0,sameSite:"none"})}}t.default=new y},472:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(293)),d=r(n(24));class u extends o.default{get(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(e=>i(this,void 0,void 0,(function*(){return yield d.default.get(e)}))))}))}adjustPlan(e,t){return i(this,void 0,void 0,(function*(){this.handleWithAuthorization(e,t,(t=>i(this,void 0,void 0,(function*(){return yield d.default.adjustPlan(t,e.body)}))))}))}}t.default=new u},607:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(860)),d=r(n(710)),u=r(n(185)),a=r(n(341)),s=r(n(230)),l=r(n(202)),c=(0,o.default)();c.use(l.default),c.use(o.default.json()),c.use((0,d.default)()),c.use("/api",a.default);const f=process.env.PORT||s.default.get("port");u.default.set("strictQuery",!1),function(){i(this,void 0,void 0,(function*(){try{yield u.default.connect(s.default.get("dbUrl")),c.listen(f,(()=>console.log("Ok! Server is working...")))}catch(e){console.log(e)}}))}()},701:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(185),r=new i.Schema({userId:{type:i.Schema.Types.ObjectId,index:!0},dayOfWeek:{type:Number,required:!0},planId:{type:i.Schema.Types.ObjectId,required:!0},from:{type:Number,required:!0},to:{type:Number,required:!0}});t.default=(0,i.model)("DayDistribution",r)},829:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(185),r=new i.Schema({userId:{type:i.Schema.Types.ObjectId,index:!0},title:{type:String,required:!0},text:{type:String,default:""},color:{type:String,required:!0},duration:{type:Number,required:!0}});t.default=(0,i.model)("Plan",r)},920:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(185),r=new i.Schema({userId:{type:i.Schema.Types.ObjectId,index:!0},planId:{type:i.Schema.Types.ObjectId,required:!0},deviation:{type:Number,default:0},confirmedDate:{type:Date,required:!0}});t.default=(0,i.model)("Statistics",r)},354:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(185),r=new i.Schema({userId:{type:i.Schema.Types.ObjectId,index:!0},title:{type:String,required:!0}});t.default=(0,i.model)("Thought",r)},4:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(185),r=new i.Schema({name:{type:String,required:!0},email:{type:String,required:!0},password:{type:String,required:!0},confirmationDay:{type:String,required:!0},confirmationTime:{type:Number,required:!0},createdAt:{type:Date,required:!0}});t.default=(0,i.model)("User",r)},380:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=n(185),r=new i.Schema({userId:{type:i.Schema.Types.ObjectId,index:!0},dayOfWeek:{type:Number,required:!0},planId:{type:i.Schema.Types.ObjectId,required:!0},duration:{type:Number,required:!0}});t.default=(0,i.model)("WeekDistribution",r)},312:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(701)),d=r(n(945)),u=r(n(659)),a=r(n(24));class s extends d.default{constructor(){super(...arguments),this.model=o.default}get(e,t){return i(this,void 0,void 0,(function*(){const n={distributedPlans:[],notDistributedPlans:[]};let i,r,o;[i,r,o]=yield Promise.all([this.getByParameters({userId:e,dayOfWeek:t}),a.default.getByParameters({userId:e,dayOfWeek:t}),u.default.get(e)]),o=o.map((e=>e.toObject()));for(let e=0;e<i.length;e++){const t=i[e];this.addDistributedPlan(t,o,n),this.subtractDistributedTimeFromWeekDistribution(r,t)}for(let e=0;e<r.length;e++)this.addNotDistributedPlan(r[e],o,n);return n.distributedPlans.sort(((e,t)=>e.from-t.from)),n}))}subtractDistributedTimeFromWeekDistribution(e,t){const n=e.find((e=>String(e.planId)===String(t.planId)));n&&(n.duration-=t.to-t.from)}addDistributedPlan(e,t,n){const i=t.find((t=>t._id.toString()===e.planId.toString()));if(i){const t={from:e.from,to:e.to},r=Object.assign({},i,t);delete r.duration,n.distributedPlans.push(r)}}addNotDistributedPlan(e,t,n){if(e.duration){const i=t.find((t=>t._id.toString()===e.planId.toString()));if(i){const t=Object.assign({},i,{duration:e.duration});n.notDistributedPlans.push(t)}}}create(e,t){return i(this,void 0,void 0,(function*(){this.checkDayOfWeek(t.dayOfWeek),this.checkPeriod(t.from,t.to);const n=Object.assign({},t,{userId:e});return yield this.model.create(n)}))}adjustPlan(e,t){return i(this,void 0,void 0,(function*(){const n=t.dayDistribution;return yield this.deleteByParameters({userId:e,dayOfWeek:t.dayOfWeek}),yield Promise.all(n.map((n=>(n.dayOfWeek=t.dayOfWeek,this.create(e,n)))))}))}}t.default=new s},659:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(185),d=r(n(829)),u=r(n(945)),a=r(n(312)),s=r(n(24)),l=r(n(814));class c extends u.default{constructor(){super(...arguments),this.model=d.default}get(e){return i(this,void 0,void 0,(function*(){return yield this.model.find({userId:e})}))}getById(e,t){return i(this,void 0,void 0,(function*(){const n=yield this.model.findById(t).where({userId:e});return n?n.toObject():null}))}create(e,t){return i(this,void 0,void 0,(function*(){const n=Object.assign({},t,{userId:e});return yield this.model.create(n)}))}update(e,t){return i(this,void 0,void 0,(function*(){const n={title:t.title,text:t.text,color:t.color,duration:t.duration};return yield this.model.findByIdAndUpdate(t._id,n,{new:!0}).where({userId:e})}))}delete(e,t){return i(this,void 0,void 0,(function*(){const n=[l.default,a.default,s.default];return yield Promise.all(n.map((n=>n.deleteByParameters({userId:e,planId:new o.Types.ObjectId(t)})))),yield this.model.findByIdAndDelete(t).where({userId:e})}))}}t.default=new c},945:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},d=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const u=n(96),a=o(n(712));t.default=class{getByParameters(e){return d(this,void 0,void 0,(function*(){return yield this.model.find(e)}))}deleteByParameters(e){return d(this,void 0,void 0,(function*(){yield this.model.deleteMany(e)}))}checkDayOfWeek(e){if(e<0||e>6)throw new u.ClientError(`${a.ErrorMessages.e2002} "day of week"`)}checkDuration(e){if(e<0)throw new u.ClientError(`${a.ErrorMessages.e2002} "duration"`)}checkPeriod(e,t){switch(!0){case e<0||e>1440:throw new u.ClientError(`${a.ErrorMessages.e2002} "from"`);case t<0||t>1440:throw new u.ClientError(`${a.ErrorMessages.e2002} "to"`);case e>t:throw new u.ClientError(a.ErrorMessages.e2003)}}}},814:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},d=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(185),s=u(n(920)),l=u(n(945)),c=u(n(24)),f=u(n(659)),h=u(n(105)),y=o(n(712));class v extends l.default{constructor(){super(...arguments),this.model=s.default}get(e){return d(this,void 0,void 0,(function*(){const t=[],n=[];let i,r;[i,r]=yield Promise.all([this.model.find({userId:e}),f.default.get(e)]),r=r.map((e=>e.toObject()));for(let e=0;e<i.length;e++){const o=i[e].planId.toString();if(!n.includes(o)){const d=i.filter((e=>e.planId.toString()===o));this.addAverageStatistics(i[e],d,r,t),n.push(o)}}return t}))}addAverageStatistics(e,t,n,i){const r=n.find((t=>t._id.toString()===e.planId.toString()));if(r){const e=t.length,n=t.reduce(((e,t)=>e+t.deviation),0),o=Math.round(n/e),d=Object.assign({},r,{deviation:o});delete d.duration,i.push(d)}}create(e,t){return d(this,void 0,void 0,(function*(){const n=Object.assign({},t,{userId:e});return yield this.model.create(n)}))}getCalculatedDeviation(e,t){switch(!1){case Boolean(e):if(t)return t.duration;break;case Boolean(t):if(e)return-e.duration;break;default:if(e&&t)return t.duration-e.duration}return 0}confirmDay(e,t){return d(this,void 0,void 0,(function*(){let n=[];const i=t.dayDistribution;let r;[r,n]=yield Promise.all([h.default.getById(e),c.default.getByParameters({userId:e,dayOfWeek:t.dayOfWeek})]);const o=new Set;n.forEach((e=>o.add(e.planId.toString()))),i.forEach((e=>o.add(e.planId.toString())));const d=Array.from(o.values()),u=this.getConfirmationDate(r);return yield this.model.deleteMany({userId:e,confirmedDate:u}),yield Promise.all(d.map((t=>{const r=n.find((e=>String(e.planId)===t)),o=i.find((e=>String(e.planId)===t)),d={userId:e,planId:new a.Types.ObjectId(t),deviation:this.getCalculatedDeviation(r,o),confirmedDate:u};return this.create(e,d)})))}))}getConfirmationDate(e){const t=new Date;return t.setHours(0,0,0,0),e.confirmationDay===y.ConfirmationDays.yesterday&&t.setDate(t.getDate()-1),t}isDayConfirmed(e){return d(this,void 0,void 0,(function*(){const t=yield h.default.getById(e),n=this.getConfirmationDate(t);return yield this.isConfirmationExists(e,n)}))}isConfirmationExists(e,t){return d(this,void 0,void 0,(function*(){const n=yield this.model.findOne({userId:e,confirmedDate:t});return Boolean(n)}))}}t.default=new v},241:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(354)),d=r(n(945)),u=r(n(659));class a extends d.default{constructor(){super(...arguments),this.model=o.default}get(e){return i(this,void 0,void 0,(function*(){return yield this.model.find({userId:e})}))}getById(e,t){return i(this,void 0,void 0,(function*(){return yield this.model.findById(t).where({userId:e})}))}create(e,t){return i(this,void 0,void 0,(function*(){const n=Object.assign({},t,{userId:e});return yield this.model.create(n)}))}update(e,t){return i(this,void 0,void 0,(function*(){const n={title:t.title};return yield this.model.findByIdAndUpdate(t._id,n,{new:!0}).where({userId:e})}))}convertToPlan(e,t,n){return i(this,void 0,void 0,(function*(){const i=yield this.delete(e,t);if(i){const t={userId:i.userId,title:n.title,text:n.text,color:n.color,duration:n.duration};return yield u.default.create(e,t)}return null}))}delete(e,t){return i(this,void 0,void 0,(function*(){return yield this.model.findByIdAndDelete(t).where({userId:e})}))}}t.default=new a},105:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},d=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=u(n(432)),s=u(n(344)),l=u(n(4)),c=u(n(945)),f=u(n(312)),h=u(n(312)),y=u(n(312)),v=u(n(24)),p=u(n(814)),m=u(n(230)),_=n(96),b=o(n(712));class g extends c.default{constructor(){super(...arguments),this.model=l.default}get(){return d(this,void 0,void 0,(function*(){return yield this.model.find()}))}getById(e){return d(this,void 0,void 0,(function*(){return yield this.model.findById(e)}))}create(e){return d(this,void 0,void 0,(function*(){if(yield this.model.findOne({email:e.email}))throw new _.ClientError(`User with email ${e.email} already exist`);const t=yield a.default.hash(e.password,10),n=Object.assign({},e);return n.password=t,n.confirmationDay=b.Constants.defaultConfirmationDay,n.confirmationTime=b.Constants.defaultConfirmationTime,n.createdAt=new Date,yield this.model.create(n)}))}login(e){return d(this,void 0,void 0,(function*(){const t=yield this.model.findOne({email:e.email});if(!t)throw new _.ClientError(`User with email ${e.email} not found`,b.StatusCodes.NotFound);if(!a.default.compareSync(e.password,t.password))throw new _.ClientError(b.ErrorMessages.e1001);const n=e.remember?m.default.get("tokenExpiresInLong"):m.default.get("tokenExpiresInShort");return{token:s.default.sign({id:t._id},m.default.get("jwtSecretKey"),{expiresIn:n}),user:t}}))}update(e,t){return d(this,void 0,void 0,(function*(){const n={name:t.name,confirmationDay:t.confirmationDay,confirmationTime:t.confirmationTime};return yield this.model.findByIdAndUpdate(e,n,{new:!0})}))}delete(e){return d(this,void 0,void 0,(function*(){const t=[f.default,h.default,p.default,y.default,v.default];return yield Promise.all(t.map((t=>t.deleteByParameters({userId:e})))),yield this.model.findByIdAndDelete(e)}))}}t.default=new g},24:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function d(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,u)}a((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(380)),d=r(n(945)),u=r(n(659)),a=n(96);class s extends d.default{constructor(){super(...arguments),this.model=o.default}get(e){return i(this,void 0,void 0,(function*(){const t=[[],[],[],[],[],[],[]];let n,i;[n,i]=yield Promise.all([this.model.find({userId:e}),u.default.get(e)]);for(let e=0;e<n.length;e++){const r=n[e],o=i.find((e=>e._id.toString()===r.planId.toString()));if(o){const e=Object.assign({},o.toObject(),{duration:r.duration});t[r.dayOfWeek].push(e)}}return t}))}create(e,t){return i(this,void 0,void 0,(function*(){this.checkDayOfWeek(t.dayOfWeek),this.checkDuration(t.duration);const n=Object.assign({},t,{userId:e});return yield this.model.create(n)}))}adjustPlan(e,t){return i(this,void 0,void 0,(function*(){let n,i;if([n,i]=yield Promise.all([this.model.find({userId:e,planId:t.planId}),u.default.getById(e,t.planId)]),!i)throw new a.ClientError(`The user has no plan with ID ${t.planId}`);const r=n.reduce(((e,t)=>e+t.duration),0),o=r+t.duration;if(i.duration<o)throw new a.ClientError("The plan duration is less than distributed");const d=n.find((e=>e.dayOfWeek===t.dayOfWeek));if(!d)return yield this.create(e,t);const s=d.duration+t.duration,l=d._id;if(s){this.checkDuration(s);const t={duration:s};return yield this.model.findByIdAndUpdate(l,t,{new:!0}).where({userId:e})}return yield this.model.findByIdAndDelete(l).where({userId:e})}))}}t.default=new s},432:e=>{e.exports=require("bcryptjs")},710:e=>{e.exports=require("cookie-parser")},860:e=>{e.exports=require("express")},553:e=>{e.exports=require("express-validator")},344:e=>{e.exports=require("jsonwebtoken")},185:e=>{e.exports=require("mongoose")}},t={};!function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}(607)})();